<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Princess Garden Adventure</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè∞</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            overflow: hidden;
            font-family: 'Comic Sans MS', 'Chalkboard', cursive, sans-serif;
            touch-action: manipulation;
            background: linear-gradient(to bottom, #87CEEB 0%, #87CEEB 60%, #90EE90 60%, #228B22 100%);
        }

        /* ============ TITLE SCREEN ============ */
        .title-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #FF9AA2 0%, #FFB7B2 25%, #FFDAC1 50%, #E2F0CB 75%, #B5EAD7 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            transition: opacity 1s, transform 1s;
        }

        .title-screen.hidden {
            opacity: 0;
            transform: scale(1.1);
            pointer-events: none;
        }

        .title-logo {
            font-size: 48px;
            color: #4A0080;
            text-shadow: 3px 3px 0 #FFD700, 6px 6px 0 #FF69B4;
            animation: titleBounce 2s ease-in-out infinite;
            text-align: center;
            margin-bottom: 20px;
        }

        @keyframes titleBounce {
            0%, 100% { transform: translateY(0) rotate(-2deg); }
            50% { transform: translateY(-20px) rotate(2deg); }
        }

        .title-characters {
            display: flex;
            gap: 20px;
            margin: 30px 0;
        }

        .title-character {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 5px solid #FFD700;
            overflow: hidden;
            animation: characterFloat 3s ease-in-out infinite;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .title-character:nth-child(2) { animation-delay: -1s; }
        .title-character:nth-child(3) { animation-delay: -2s; }

        .title-character img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .title-character:nth-child(3) img {
            object-position: center 15%;
            transform: scale(0.85);
        }

        @keyframes characterFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        .title-subtitle {
            font-size: 24px;
            color: #9370DB;
            margin-bottom: 40px;
            animation: subtitlePulse 2s ease-in-out infinite;
        }

        @keyframes subtitlePulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }

        .start-button {
            font-size: 32px;
            padding: 20px 60px;
            background: linear-gradient(135deg, #FF69B4, #FFD700);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-family: inherit;
            box-shadow: 0 10px 30px rgba(255, 105, 180, 0.5), inset 0 -5px 0 rgba(0,0,0,0.2);
            transition: all 0.2s;
            animation: buttonGlow 2s ease-in-out infinite;
        }

        .start-button:hover {
            transform: scale(1.1) translateY(-5px);
            box-shadow: 0 15px 40px rgba(255, 105, 180, 0.6);
        }

        .start-button:active {
            transform: scale(1.05);
        }

        @keyframes buttonGlow {
            0%, 100% { box-shadow: 0 10px 30px rgba(255, 105, 180, 0.5), inset 0 -5px 0 rgba(0,0,0,0.2); }
            50% { box-shadow: 0 10px 50px rgba(255, 215, 0, 0.8), inset 0 -5px 0 rgba(0,0,0,0.2); }
        }

        .title-sparkles {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }

        .title-sparkle {
            position: absolute;
            font-size: 30px;
            animation: sparkleFloat 4s ease-in-out infinite;
        }

        @keyframes sparkleFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); opacity: 1; }
            50% { transform: translateY(-30px) rotate(180deg); opacity: 0.5; }
        }

        /* ============ STORY SCREEN ============ */
        .story-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2500;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
        }

        .story-screen.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .story-text {
            font-size: 28px;
            color: #FFD700;
            text-align: center;
            max-width: 80%;
            line-height: 1.6;
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s;
        }

        .story-text.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .story-images {
            display: flex;
            gap: 30px;
            justify-content: center;
            align-items: center;
            margin: 30px 0;
        }

        .story-image {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 5px solid #FFD700;
            opacity: 0;
            transform: scale(0);
            transition: all 0.5s;
            overflow: hidden;
        }

        .story-image:not(.visible) {
            width: 0;
            height: 0;
            border: none;
            margin: 0;
            padding: 0;
        }

        .story-image.visible {
            opacity: 1;
            transform: scale(1);
        }

        .story-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .story-image:nth-child(2) img {
            object-position: center 30%;
        }

        /* Pinky needs to be zoomed out to fit in circle */
        .story-image img[src*="Pinky"] {
            object-fit: cover;
            object-position: center 20%;
            transform: scale(0.85);
        }

        .skip-button {
            position: absolute;
            bottom: 30px;
            right: 30px;
            padding: 10px 30px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            border-radius: 25px;
            font-size: 18px;
            cursor: pointer;
            font-family: inherit;
        }

        .menu-button {
            position: absolute;
            top: 15px;
            left: 15px;
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.9);
            border: 3px solid #FFD700;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            z-index: 500;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .menu-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
        }

        .menu-button:active {
            transform: scale(0.95);
        }

        /* ============ GAME CONTAINER ============ */
        .game-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            overflow: hidden;
        }

        /* ============ SKY & BACKGROUND ============ */
        .sky {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 60%;
            background: linear-gradient(180deg, #87CEEB 0%, #B0E0E6 50%, #F0F8FF 100%);
            transition: background 3s;
            cursor: pointer;
            z-index: 0;
        }

        /* Sun with rays - centered more */
        .sun {
            position: absolute;
            top: 30px;
            right: 35%;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, #FFD700 0%, #FFA500 100%);
            border-radius: 50%;
            box-shadow: 0 0 60px #FFD700, 0 0 100px #FFA500;
            cursor: pointer;
            transition: transform 0.3s, top 0.8s ease-in-out, right 0.8s ease-in-out, left 0.8s ease-in-out;
            animation: sunPulse 4s ease-in-out infinite;
        }

        .sun.centered {
            top: 15%;
            right: auto;
            left: 50%;
            transform: translateX(-50%);
        }

        /* Moon */
        .moon {
            position: absolute;
            top: 40px;
            left: 25%;
            width: 70px;
            height: 70px;
            background: radial-gradient(circle at 30% 30%, #FFFACD 0%, #F0E68C 50%, #DAA520 100%);
            border-radius: 50%;
            box-shadow: 0 0 30px rgba(255, 250, 205, 0.8), 0 0 60px rgba(255, 215, 0, 0.4);
            cursor: pointer;
            transition: transform 0.3s;
            animation: moonGlow 5s ease-in-out infinite;
        }

        .moon::before {
            content: '';
            position: absolute;
            top: 10%;
            left: 15%;
            width: 15px;
            height: 15px;
            background: rgba(139, 119, 42, 0.3);
            border-radius: 50%;
        }

        .moon::after {
            content: '';
            position: absolute;
            top: 40%;
            right: 20%;
            width: 10px;
            height: 10px;
            background: rgba(139, 119, 42, 0.2);
            border-radius: 50%;
        }

        @keyframes moonGlow {
            0%, 100% { box-shadow: 0 0 30px rgba(255, 250, 205, 0.8), 0 0 60px rgba(255, 215, 0, 0.4); }
            50% { box-shadow: 0 0 40px rgba(255, 250, 205, 1), 0 0 80px rgba(255, 215, 0, 0.6); }
        }

        @keyframes starTwinkle {
            0% { opacity: 0; transform: scale(0) rotate(0deg); }
            50% { opacity: 1; transform: scale(1.2) rotate(180deg); }
            100% { opacity: 0; transform: scale(0) rotate(360deg); }
        }

        .moon:hover { transform: scale(1.15); }

        .sun::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 150%;
            height: 150%;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpolygon fill='%23FFD700' points='50,0 54,40 60,35 54,45 100,50 54,55 60,65 54,60 50,100 46,60 40,65 46,55 0,50 46,45 40,35 46,40' opacity='0.5'/%3E%3C/svg%3E");
            transform: translate(-50%, -50%);
            animation: sunRays 20s linear infinite;
            pointer-events: none;
        }

        @keyframes sunPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes sunRays {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .sun:hover { transform: scale(1.2); }

        /* Clouds */
        .cloud {
            position: absolute;
            background: white;
            border-radius: 50px;
            cursor: pointer;
            filter: drop-shadow(0 5px 10px rgba(0,0,0,0.1));
            transition: transform 0.3s;
        }

        .cloud::before, .cloud::after {
            content: '';
            position: absolute;
            background: white;
            border-radius: 50%;
        }

        .cloud-1 {
            width: 150px;
            height: 60px;
            top: 80px;
            animation: cloudFloat1 30s linear infinite;
        }

        .cloud-1::before {
            width: 70px;
            height: 70px;
            top: -35px;
            left: 25px;
        }

        .cloud-1::after {
            width: 50px;
            height: 50px;
            top: -25px;
            left: 75px;
        }

        .cloud-2 {
            width: 120px;
            height: 50px;
            top: 140px;
            animation: cloudFloat2 25s linear infinite;
        }

        .cloud-2::before {
            width: 55px;
            height: 55px;
            top: -28px;
            left: 20px;
        }

        .cloud-2::after {
            width: 40px;
            height: 40px;
            top: -18px;
            left: 60px;
        }

        .cloud-3 {
            width: 100px;
            height: 40px;
            top: 50px;
            animation: cloudFloat3 35s linear infinite;
        }

        .cloud-3::before {
            width: 45px;
            height: 45px;
            top: -22px;
            left: 15px;
        }

        .cloud-3::after {
            width: 35px;
            height: 35px;
            top: -15px;
            left: 50px;
        }

        @keyframes cloudFloat1 {
            from { left: -200px; }
            to { left: 110%; }
        }

        @keyframes cloudFloat2 {
            from { left: -180px; }
            to { left: 110%; }
        }

        @keyframes cloudFloat3 {
            from { left: -150px; }
            to { left: 110%; }
        }

        .cloud:hover { transform: scale(1.1); }

        /* Rainbow - using stacked arcs */
        .rainbow {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 1200px;
            height: 600px;
            display: none;
            pointer-events: none;
            overflow: visible;
            filter: drop-shadow(0 0 40px rgba(255,255,255,0.7))
                    drop-shadow(0 0 80px rgba(255,200,100,0.4));
            cursor: pointer;
        }

        .rainbow-arc {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 50% 50% 0 0;
            border-style: solid;
            border-bottom: none;
        }

        .rainbow-arc:nth-child(1) { width: 1200px; height: 600px; border-width: 40px; border-color: #FF0000 transparent transparent transparent; filter: drop-shadow(0 0 15px #FF0000) drop-shadow(0 0 30px #FF000088); }
        .rainbow-arc:nth-child(2) { width: 1120px; height: 560px; border-width: 40px; border-color: #FF7F00 transparent transparent transparent; filter: drop-shadow(0 0 15px #FF7F00) drop-shadow(0 0 30px #FF7F0088); }
        .rainbow-arc:nth-child(3) { width: 1040px; height: 520px; border-width: 40px; border-color: #FFFF00 transparent transparent transparent; filter: drop-shadow(0 0 15px #FFFF00) drop-shadow(0 0 30px #FFFF0088); }
        .rainbow-arc:nth-child(4) { width: 960px; height: 480px; border-width: 40px; border-color: #00FF00 transparent transparent transparent; filter: drop-shadow(0 0 15px #00FF00) drop-shadow(0 0 30px #00FF0088); }
        .rainbow-arc:nth-child(5) { width: 880px; height: 440px; border-width: 40px; border-color: #00BFFF transparent transparent transparent; filter: drop-shadow(0 0 15px #00BFFF) drop-shadow(0 0 30px #00BFFF88); }
        .rainbow-arc:nth-child(6) { width: 800px; height: 400px; border-width: 40px; border-color: #0066FF transparent transparent transparent; filter: drop-shadow(0 0 15px #0066FF) drop-shadow(0 0 30px #0066FF88); }
        .rainbow-arc:nth-child(7) { width: 720px; height: 360px; border-width: 40px; border-color: #9900FF transparent transparent transparent; filter: drop-shadow(0 0 15px #9900FF) drop-shadow(0 0 30px #9900FF88); }

        .rainbow.visible {
            display: block;
            pointer-events: auto;
            animation: rainbowFadeInOut 12s ease-in-out forwards;
        }

        @keyframes rainbowFadeInOut {
            0% { opacity: 0; transform: translateX(-50%) scale(0.3); }
            10% { opacity: 1; transform: translateX(-50%) scale(1.05); }
            15% { transform: translateX(-50%) scale(1); }
            80% { opacity: 1; transform: translateX(-50%) scale(1); }
            90% { opacity: 0.8; transform: translateX(-50%) scale(1.02); }
            100% { opacity: 0; transform: translateX(-50%) scale(1.1); }
        }

        /* Sun dance animation when cloud is clicked */
        .sun.dancing {
            animation: sunDance 0.5s ease-in-out infinite !important;
        }

        @keyframes sunDance {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(2.5) rotate(-20deg); }
            50% { transform: scale(2.2) rotate(20deg); }
            75% { transform: scale(2.5) rotate(-15deg); }
        }

        /* Ground */
        .ground {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 45%;
            background: linear-gradient(180deg, #90EE90 0%, #7CB342 20%, #558B2F 100%);
        }

        /* Grass blades */
        .grass-container {
            position: absolute;
            bottom: 40%;
            left: 0;
            width: 100%;
            height: 60px;
            overflow: hidden;
        }

        .grass-blade {
            position: absolute;
            bottom: 0;
            width: 8px;
            height: 40px;
            background: linear-gradient(to top, #228B22, #32CD32);
            border-radius: 50% 50% 0 0;
            transform-origin: bottom center;
            animation: grassSway 2s ease-in-out infinite;
        }

        @keyframes grassSway {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }

        /* ============ CASTLE ============ */
        .castle {
            position: absolute;
            bottom: 38%;
            left: 30px;
            cursor: pointer;
            transition: transform 0.3s;
            filter: drop-shadow(8px 8px 20px rgba(0,0,0,0.4))
                    drop-shadow(0 0 30px rgba(255,215,0,0.3));
            z-index: 10;
            transform: scale(1.3);
        }

        .castle:hover { transform: scale(1.4); }

        .castle.celebrating {
            animation: castleCelebrate 0.5s ease-in-out infinite;
            filter: drop-shadow(8px 8px 20px rgba(0,0,0,0.4))
                    drop-shadow(0 0 50px rgba(255,215,0,0.8))
                    drop-shadow(0 0 80px rgba(255,100,255,0.5));
        }

        @keyframes castleCelebrate {
            0%, 100% { transform: scale(2) rotate(0deg); }
            25% { transform: scale(2.2) rotate(-3deg); }
            50% { transform: scale(2.1) rotate(3deg); }
            75% { transform: scale(2.2) rotate(-2deg); }
        }

        .castle-base {
            display: flex;
            align-items: flex-end;
        }

        .castle-tower {
            width: 55px;
            height: 120px;
            background: linear-gradient(135deg, #FFB6C1, #DDA0DD, #E6B0AA);
            position: relative;
            border: 4px solid #9B59B6;
            box-shadow: inset -5px -5px 15px rgba(0,0,0,0.2),
                        inset 5px 5px 15px rgba(255,255,255,0.3);
        }

        .castle-tower::before {
            content: '';
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            border-left: 35px solid transparent;
            border-right: 35px solid transparent;
            border-bottom: 40px solid #8E44AD;
        }

        .castle-tower::after {
            content: 'üö©';
            position: absolute;
            top: -65px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            animation: flagWave 1s ease-in-out infinite alternate;
        }

        @keyframes flagWave {
            from { transform: translateX(-50%) rotate(-10deg); }
            to { transform: translateX(-50%) rotate(10deg); }
        }

        .castle-tower.main {
            width: 80px;
            height: 110px;
            margin: 0 -5px;
        }

        .castle-window {
            width: 15px;
            height: 20px;
            background: linear-gradient(to bottom, #FFE4B5, #87CEEB);
            border-radius: 8px 8px 0 0;
            position: absolute;
            top: 25px;
            left: 50%;
            transform: translateX(-50%);
            border: 2px solid #4A0080;
        }

        .castle-door {
            width: 25px;
            height: 40px;
            background: linear-gradient(to bottom, #5D4037, #3E2723);
            border-radius: 12px 12px 0 0;
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            border: 2px solid #4A0080;
        }

        .castle-door::after {
            content: '';
            position: absolute;
            right: 5px;
            top: 50%;
            width: 5px;
            height: 5px;
            background: #FFD700;
            border-radius: 50%;
        }

        /* ============ TREE ============ */
        .tree {
            position: absolute;
            bottom: 42%;
            right: 12%;
            cursor: pointer;
            transition: transform 0.3s;
            filter: drop-shadow(5px 5px 10px rgba(0,0,0,0.2));
            z-index: 10;
        }

        .tree:hover { transform: scale(1.05); }

        .tree-trunk {
            width: 35px;
            height: 70px;
            background: linear-gradient(90deg, #8B4513, #A0522D, #8B4513);
            margin: 0 auto;
            border-radius: 5px;
        }

        .tree-leaves {
            width: 140px;
            height: 140px;
            background: radial-gradient(ellipse at center, #32CD32 0%, #228B22 50%, #006400 100%);
            border-radius: 50%;
            position: relative;
            top: 20px;
            animation: treeSway 4s ease-in-out infinite;
        }

        @keyframes treeSway {
            0%, 100% { transform: rotate(-1deg); }
            50% { transform: rotate(1deg); }
        }

        /* ============ POND ============ */
        .pond {
            position: absolute;
            bottom: 8%;
            right: 5%;
            width: 500px;
            height: 250px;
            background: linear-gradient(180deg, #87CEFA 0%, #4169E1 50%, #1E90FF 100%);
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.3s;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.3), 0 5px 15px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        /* Swimming Duck */
        .swimming-duck {
            position: absolute;
            font-size: 45px;
            z-index: 60;
            cursor: pointer;
            animation: duckSwim 12s ease-in-out infinite;
        }

        @keyframes duckSwim {
            0% { transform: translateX(0) translateY(0); }
            25% { transform: translateX(60px) translateY(-8px); }
            50% { transform: translateX(100px) translateY(5px); }
            75% { transform: translateX(50px) translateY(-5px); }
            100% { transform: translateX(0) translateY(0); }
        }

        .flying-duck {
            position: fixed;
            font-size: 50px;
            z-index: 200;
            animation: duckFlyIn 3s ease-out forwards;
        }

        @keyframes duckFlyIn {
            0% { top: -50px; left: 110%; transform: rotate(-10deg); }
            100% { top: var(--target-top); left: var(--target-left); transform: rotate(0deg); }
        }

        .pond:hover { transform: scale(1.05); }

        .pond-shine {
            position: absolute;
            top: 10px;
            left: 20px;
            width: 40px;
            height: 20px;
            background: rgba(255,255,255,0.4);
            border-radius: 50%;
            animation: pondShine 3s ease-in-out infinite;
        }

        @keyframes pondShine {
            0%, 100% { opacity: 0.4; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        .lily-pad {
            position: absolute;
            width: 50px;
            height: 40px;
            background: radial-gradient(ellipse at center, #32CD32, #228B22);
            border-radius: 50%;
            animation: lilyFloat 3s ease-in-out infinite;
        }

        .lily-pad::before {
            content: '';
            position: absolute;
            top: 0;
            left: 45%;
            width: 4px;
            height: 50%;
            background: #4169E1;
        }

        .lily-pad.pad1 { top: 40px; left: 50px; }
        .lily-pad.pad2 { top: 80px; left: 220px; animation-delay: -1s; }
        .lily-pad.pad3 { top: 110px; left: 120px; animation-delay: -0.5s; }

        @keyframes lilyFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-3px) rotate(3deg); }
        }

        .fish {
            position: absolute;
            top: 40%;
            left: 20%;
            opacity: 1;
            z-index: 10;
            cursor: pointer;
            animation: fishSwim 6s ease-in-out infinite;
            pointer-events: auto;
        }

        .fish.jump {
            animation: fishJump 1.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        @keyframes fishSwim {
            0%, 100% {
                left: 15%;
                top: 40%;
                transform: scaleX(1);
            }
            25% {
                left: 60%;
                top: 55%;
                transform: scaleX(1);
            }
            50% {
                left: 70%;
                top: 35%;
                transform: scaleX(-1);
            }
            75% {
                left: 30%;
                top: 50%;
                transform: scaleX(-1);
            }
        }

        .fish-body {
            width: 40px;
            height: 24px;
            background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 50%, #FFBE76 100%);
            border-radius: 50% 50% 40% 40% / 60% 60% 40% 40%;
            position: relative;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .fish-body::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 8px;
            width: 6px;
            height: 6px;
            background: #000;
            border-radius: 50%;
            box-shadow: inset 2px 2px 0 rgba(255,255,255,0.5);
        }

        .fish-body::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 5px;
            width: 15px;
            height: 8px;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
        }

        .fish-tail {
            position: absolute;
            right: -18px;
            top: 0;
            width: 0;
            height: 0;
            border-left: 22px solid #FF6B6B;
            border-top: 12px solid transparent;
            border-bottom: 12px solid transparent;
            animation: tailWag 0.15s ease-in-out infinite alternate;
        }

        @keyframes tailWag {
            from { transform: rotate(-10deg); }
            to { transform: rotate(10deg); }
        }

        @keyframes fishJump {
            0% {
                transform: translate(-50%, 100%) rotate(45deg) scale(0.5);
                opacity: 0;
            }
            8% {
                opacity: 1;
            }
            20% {
                transform: translate(-30%, -350%) rotate(90deg) scale(1.3);
            }
            35% {
                transform: translate(0%, -450%) rotate(180deg) scale(1.5);
            }
            50% {
                transform: translate(30%, -400%) rotate(270deg) scale(1.4);
            }
            65% {
                transform: translate(50%, -250%) rotate(360deg) scale(1.2);
            }
            80% {
                transform: translate(60%, -50%) rotate(400deg) scale(1);
                opacity: 1;
            }
            90% {
                transform: translate(65%, 80%) rotate(420deg) scale(0.7);
                opacity: 0.7;
            }
            100% {
                transform: translate(70%, 150%) rotate(450deg) scale(0.4);
                opacity: 0;
            }
        }

        /* Water splash effect */
        .splash {
            position: absolute;
            font-size: 24px;
            animation: splashAnim 0.6s ease-out forwards;
            pointer-events: none;
        }

        @keyframes splashAnim {
            0% { transform: scale(0.5) translateY(0); opacity: 1; }
            100% { transform: scale(1.5) translateY(-30px); opacity: 0; }
        }

        /* ============ FLOWERS ============ */
        .flower {
            position: absolute;
            cursor: pointer;
            transition: transform 0.3s;
            animation: flowerSway 3s ease-in-out infinite;
        }

        .flower:hover { transform: scale(1.3) rotate(10deg); }

        .flower-stem {
            width: 4px;
            height: 50px;
            background: linear-gradient(to top, #228B22, #32CD32);
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 2px;
        }

        .flower-head {
            position: relative;
            width: 40px;
            height: 40px;
        }

        .flower-petal {
            position: absolute;
            width: 15px;
            height: 20px;
            border-radius: 50%;
            top: 50%;
            left: 50%;
        }

        .flower-center {
            position: absolute;
            width: 16px;
            height: 16px;
            background: radial-gradient(circle, #FFD700, #FFA500);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2;
        }

        @keyframes flowerSway {
            0%, 100% { transform: rotate(-3deg); }
            50% { transform: rotate(3deg); }
        }

        .flower-1 { bottom: 38%; left: 18%; animation-delay: 0s; }
        .flower-2 { bottom: 36%; left: 38%; animation-delay: -1s; }
        .flower-3 { bottom: 40%; right: 28%; animation-delay: -2s; }
        .flower-4 { bottom: 34%; left: 55%; animation-delay: -0.5s; }
        .flower-5 { bottom: 42%; left: 75%; animation-delay: -1.5s; }

        /* ============ CHARACTERS ============ */
        .character {
            position: absolute;
            cursor: pointer;
            transition: transform 0.3s, left 1.5s ease-in-out, bottom 1.5s ease-in-out;
            z-index: 50;
        }

        .character:hover { transform: scale(1.1); }

        .character-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .character-crown {
            font-size: 35px;
            animation: crownBob 2s ease-in-out infinite;
            filter: drop-shadow(0 2px 5px rgba(0,0,0,0.3));
        }

        @keyframes crownBob {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-8px) rotate(5deg); }
        }

        .character-frame {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            border: 6px solid;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            animation: characterBounce 2s ease-in-out infinite;
        }

        .character-frame img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }


        @keyframes characterBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        .character-name {
            margin-top: 8px;
            font-size: 16px;
            font-weight: bold;
            color: #4A0080;
            text-shadow: 1px 1px 0 white, -1px -1px 0 white, 1px -1px 0 white, -1px 1px 0 white;
            background: rgba(255,255,255,0.8);
            padding: 3px 12px;
            border-radius: 15px;
        }

        .princess-1 {
            bottom: 18%;
            left: 22%;
        }

        .princess-1 .character-frame {
            border-color: #FF69B4;
            animation-delay: 0s;
        }

        .princess-2 {
            bottom: 20%;
            left: 42%;
        }

        .princess-2 .character-frame {
            border-color: #DDA0DD;
            animation-delay: -0.5s;
        }

        .dog {
            bottom: 15%;
            left: 0;
            right: 0;
            margin: 0 auto;
            width: fit-content;
        }

        .dog .character-frame {
            width: 150px;
            height: 150px;
            border-color: #FFB6C1;
            animation-delay: -1s;
        }

        .dog .character-frame img {
            object-fit: cover;
            object-position: center 30%;
        }

        .dog .character-crown {
            display: none;
        }

        .dog-bow {
            font-size: 32px;
            margin-bottom: 5px;
            animation: bowWiggle 1s ease-in-out infinite;
        }

        @keyframes bowWiggle {
            0%, 100% { transform: rotate(-10deg); }
            50% { transform: rotate(10deg); }
        }

        .dog.excited {
            animation: dogExcited 0.3s ease-in-out 5;
        }

        @keyframes dogExcited {
            0%, 100% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(-10deg) scale(1.1); }
            75% { transform: rotate(10deg) scale(1.1); }
        }

        /* ============ UI ELEMENTS ============ */
        .game-ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            pointer-events: none;
            z-index: 100;
        }

        .game-ui > * {
            pointer-events: auto;
        }

        .ui-left {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .ui-right {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: flex-end;
        }

        .sound-toggle, .music-toggle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #fff, #f0f0f0);
            border: 3px solid #FFD700;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }

        .sound-toggle:hover, .music-toggle:hover {
            transform: scale(1.1);
        }

        .level-display {
            background: linear-gradient(135deg, #9370DB, #4A0080);
            color: white;
            padding: 10px 25px;
            border-radius: 25px;
            font-size: 20px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .score-display {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #4A0080;
            padding: 10px 25px;
            border-radius: 25px;
            font-size: 20px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .butterfly-counter {
            background: linear-gradient(135deg, #FF69B4, #FFB6C1);
            color: white;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 22px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .star-counter {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #4A0080;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 22px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        /* ============ GAME TITLE ============ */
        .game-title {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 32px;
            color: #4A0080;
            text-shadow: 2px 2px 0 #FFD700, 4px 4px 0 #FF69B4;
            white-space: nowrap;
            cursor: pointer;
            transition: transform 0.3s;
            z-index: 10;
        }

        .game-title:hover {
            transform: translateX(-50%) scale(1.1);
        }

        /* ============ INSTRUCTIONS POPUP ============ */
        .instructions-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, #FFF5EE, #FFE4E1);
            border-radius: 30px;
            padding: 40px;
            text-align: center;
            z-index: 2000;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            max-width: 90%;
            width: 500px;
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .instructions-popup.visible {
            transform: translate(-50%, -50%) scale(1);
        }

        .instructions-popup h2 {
            color: #4A0080;
            font-size: 28px;
            margin-bottom: 20px;
        }

        .instructions-popup p {
            color: #666;
            font-size: 18px;
            margin: 15px 0;
            line-height: 1.5;
        }

        .instructions-popup .emoji-big {
            font-size: 50px;
            margin: 15px 0;
        }

        .instructions-popup button {
            margin-top: 20px;
            padding: 15px 40px;
            font-size: 22px;
            background: linear-gradient(135deg, #FF69B4, #FFD700);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-family: inherit;
            box-shadow: 0 5px 20px rgba(255, 105, 180, 0.5);
            transition: transform 0.2s;
        }

        .instructions-popup button:hover {
            transform: scale(1.05);
        }

        /* ============ EFFECTS ============ */
        .sparkle {
            position: fixed;
            width: 15px;
            height: 15px;
            pointer-events: none;
            z-index: 200;
        }

        .sparkle::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: currentColor;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
            animation: sparkleAnim 0.8s ease-out forwards;
        }

        @keyframes sparkleAnim {
            0% { transform: scale(0) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.5) rotate(180deg); opacity: 1; }
            100% { transform: scale(0) rotate(360deg); opacity: 0; }
        }

        .butterfly {
            position: fixed;
            pointer-events: none;
            z-index: 150;
            width: 50px;
            height: 40px;
        }

        .butterfly.decorative-butterfly {
            position: absolute;
            pointer-events: auto;
            cursor: pointer;
            z-index: 120;
        }

        .butterfly-body {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 6px;
            height: 20px;
            background: linear-gradient(#333, #111);
            border-radius: 3px;
            z-index: 3;
        }

        .butterfly-antenna {
            position: absolute;
            left: 50%;
            top: 5px;
            width: 2px;
            height: 10px;
            background: #333;
            border-radius: 1px;
        }

        .butterfly-antenna.left-antenna {
            transform: translateX(-6px) rotate(-30deg);
        }

        .butterfly-antenna.right-antenna {
            transform: translateX(4px) rotate(30deg);
        }

        .butterfly-antenna::after {
            content: '';
            position: absolute;
            top: -3px;
            left: -1px;
            width: 4px;
            height: 4px;
            background: #333;
            border-radius: 50%;
        }

        .butterfly-wing {
            position: absolute;
            top: 50%;
            transform-origin: right center;
            border-radius: 50% 80% 50% 80%;
            box-shadow: inset 0 0 10px rgba(255,255,255,0.5);
        }

        .butterfly-wing.top-left {
            width: 20px;
            height: 18px;
            left: 3px;
            transform: translateY(-100%) rotate(-20deg);
            animation: wingFlapTopLeft 0.12s ease-in-out infinite alternate;
        }

        .butterfly-wing.top-right {
            width: 20px;
            height: 18px;
            right: 3px;
            left: auto;
            transform-origin: left center;
            transform: translateY(-100%) rotate(20deg);
            animation: wingFlapTopRight 0.12s ease-in-out infinite alternate;
        }

        .butterfly-wing.bottom-left {
            width: 16px;
            height: 14px;
            left: 6px;
            transform: translateY(10%) rotate(10deg);
            animation: wingFlapBottomLeft 0.12s ease-in-out infinite alternate;
        }

        .butterfly-wing.bottom-right {
            width: 16px;
            height: 14px;
            right: 6px;
            left: auto;
            transform-origin: left center;
            transform: translateY(10%) rotate(-10deg);
            animation: wingFlapBottomRight 0.12s ease-in-out infinite alternate;
        }

        .butterfly-wing .wing-spot {
            position: absolute;
            border-radius: 50%;
            background: rgba(255,255,255,0.6);
        }

        @keyframes wingFlapTopLeft {
            from { transform: translateY(-100%) rotate(-20deg) rotateY(0deg); }
            to { transform: translateY(-100%) rotate(-20deg) rotateY(60deg); }
        }

        @keyframes wingFlapTopRight {
            from { transform: translateY(-100%) rotate(20deg) rotateY(0deg); }
            to { transform: translateY(-100%) rotate(20deg) rotateY(-60deg); }
        }

        @keyframes wingFlapBottomLeft {
            from { transform: translateY(10%) rotate(10deg) rotateY(0deg); }
            to { transform: translateY(10%) rotate(10deg) rotateY(50deg); }
        }

        @keyframes wingFlapBottomRight {
            from { transform: translateY(10%) rotate(-10deg) rotateY(0deg); }
            to { transform: translateY(10%) rotate(-10deg) rotateY(-50deg); }
        }

        /* Clickable Stars */
        .clickable-star {
            position: absolute;
            font-size: 30px;
            cursor: pointer;
            z-index: 50;
            transition: transform 0.3s, filter 0.3s;
            animation: starTwinkle 2s ease-in-out infinite;
        }

        .clickable-star:hover {
            transform: scale(1.3);
            filter: drop-shadow(0 0 10px gold);
        }

        @keyframes starTwinkle {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(0.9); }
        }

        /* Rain */
        .rain-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 500;
        }

        .raindrop {
            position: absolute;
            width: 3px;
            height: 25px;
            background: linear-gradient(transparent, rgba(100, 149, 237, 0.8));
            border-radius: 0 0 5px 5px;
            animation: rainFall 0.6s linear forwards;
        }

        @keyframes rainFall {
            to { transform: translateY(100vh); }
        }

        /* Lightning */
        .lightning {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            opacity: 0;
            pointer-events: none;
            z-index: 600;
        }

        .lightning.flash {
            animation: lightningFlash 0.2s ease-out;
        }

        @keyframes lightningFlash {
            0%, 100% { opacity: 0; }
            10%, 30% { opacity: 0.9; }
            20% { opacity: 0.3; }
        }

        /* Hearts */
        .heart {
            position: fixed;
            font-size: 35px;
            pointer-events: none;
            z-index: 200;
            animation: heartFloat 1.5s ease-out forwards;
        }

        @keyframes heartFloat {
            0% { transform: scale(0) translateY(0); opacity: 1; }
            50% { transform: scale(1.3) translateY(-50px); opacity: 1; }
            100% { transform: scale(0.8) translateY(-120px); opacity: 0; }
        }

        @keyframes floatUpHeart {
            0% { transform: translateY(0) scale(0.5) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            100% { transform: translateY(-100vh) scale(1.2) rotate(20deg); opacity: 0; }
        }

        /* Bird */
        .bird {
            position: fixed;
            font-size: 35px;
            pointer-events: none;
            z-index: 150;
            animation: birdFly 3s ease-in-out forwards;
        }

        @keyframes birdFly {
            0% { transform: translate(0, 0) scaleX(1); }
            25% { transform: translate(80px, -40px) scaleX(1); }
            50% { transform: translate(160px, -20px) scaleX(1); }
            75% { transform: translate(240px, -60px) scaleX(1); }
            100% { transform: translate(350px, -100px) scaleX(1); opacity: 0; }
        }

        /* Flying Bird (crosses sky) */
        .flying-bird {
            position: fixed;
            font-size: 65px;
            cursor: pointer;
            z-index: 100;
            pointer-events: auto;
            padding: 15px;
        }

        .flying-bird:hover {
            filter: drop-shadow(0 0 10px gold);
        }

        .flying-bird.fly-left {
            animation: birdFlyLeft 18s linear forwards;
        }

        .flying-bird.fly-right {
            animation: birdFlyRight 18s linear forwards;
        }

        /* Slow birds (dove) */
        .flying-bird.slow-bird.fly-left {
            animation: birdFlyLeft 30s linear forwards;
        }

        .flying-bird.slow-bird.fly-right {
            animation: birdFlyRight 30s linear forwards;
        }

        @keyframes birdFlyLeft {
            0% { left: 110%; top: 8%; transform: scaleX(1); }
            25% { top: 14%; transform: scaleX(1); }
            50% { top: 5%; transform: scaleX(1); }
            75% { top: 12%; transform: scaleX(1); }
            100% { left: -10%; top: 8%; transform: scaleX(1); }
        }

        @keyframes birdFlyRight {
            0% { left: -10%; top: 10%; transform: scaleX(-1); }
            25% { top: 5%; transform: scaleX(-1); }
            50% { top: 15%; transform: scaleX(-1); }
            75% { top: 7%; transform: scaleX(-1); }
            100% { left: 110%; top: 10%; transform: scaleX(-1); }
        }

        /* Bird caught - flies off fast */
        .flying-bird.caught {
            animation: none !important;
            transition: left 0.5s linear, top 0.3s ease-out;
        }

        .flying-bird.caught.fly-left {
            left: -15% !important;
            top: -10% !important;
        }

        .flying-bird.caught.fly-right {
            left: 115% !important;
            top: -10% !important;
        }

        /* ============ KING POPUP ============ */
        .king-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            border-radius: 30px;
            padding: 35px;
            text-align: center;
            z-index: 1500;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .king-popup.visible {
            transform: translate(-50%, -50%) scale(1);
        }

        .king-popup .king-crown {
            font-size: 70px;
            animation: kingCrownBounce 0.5s ease-in-out infinite alternate;
        }

        @keyframes kingCrownBounce {
            from { transform: rotate(-5deg); }
            to { transform: rotate(5deg); }
        }

        .king-popup .king-image {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            border: 6px solid #4A0080;
            margin: 15px auto;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .king-popup .king-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .king-popup .king-title {
            font-size: 26px;
            color: #4A0080;
            margin: 10px 0;
            font-weight: bold;
        }

        .king-popup .king-message {
            font-size: 20px;
            color: #333;
            background: rgba(255,255,255,0.5);
            padding: 10px 20px;
            border-radius: 15px;
        }

        /* Sana Popup */
        .sana-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, #FF69B4 0%, #FF1493 100%);
            border-radius: 30px;
            padding: 35px;
            text-align: center;
            z-index: 1500;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .sana-popup.visible {
            transform: translate(-50%, -50%) scale(1);
        }

        .sana-popup .sana-emoji {
            font-size: 70px;
            animation: kingCrownBounce 0.5s ease-in-out infinite alternate;
        }

        .sana-popup .sana-image {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            border: 6px solid #C71585;
            margin: 15px auto;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .sana-popup .sana-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .sana-popup .sana-title {
            font-size: 26px;
            color: #fff;
            margin: 10px 0;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .sana-popup .sana-message {
            font-size: 20px;
            color: #333;
            background: rgba(255,255,255,0.5);
            padding: 10px 20px;
            border-radius: 15px;
        }

        /* Veronika Popup */
        .veronika-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, #9370DB 0%, #8A2BE2 100%);
            border-radius: 30px;
            padding: 35px;
            text-align: center;
            z-index: 1500;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .veronika-popup.visible {
            transform: translate(-50%, -50%) scale(1);
        }

        .veronika-popup .veronika-emoji {
            font-size: 70px;
            animation: kingCrownBounce 0.5s ease-in-out infinite alternate;
        }

        .veronika-popup .veronika-image {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            border: 6px solid #4B0082;
            margin: 15px auto;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .veronika-popup .veronika-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .veronika-popup .veronika-title {
            font-size: 26px;
            color: #fff;
            margin: 10px 0;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .veronika-popup .veronika-message {
            font-size: 20px;
            color: #333;
            background: rgba(255,255,255,0.5);
            padding: 10px 20px;
            border-radius: 15px;
        }

        /* Papa Micha Horse Popup */
        .papa-horse-popup {
            position: fixed;
            transform: scale(0);
            background: linear-gradient(135deg, #228B22 0%, #006400 100%);
            border-radius: 30px;
            padding: 25px;
            text-align: center;
            z-index: 1500;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .papa-horse-popup.visible {
            transform: scale(1);
        }

        .papa-horse-popup .papa-horse-emoji {
            font-size: 70px;
            animation: kingCrownBounce 0.5s ease-in-out infinite alternate;
        }

        .papa-horse-popup .papa-horse-image {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            border: 6px solid #8B4513;
            margin: 15px auto;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .papa-horse-popup .papa-horse-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .papa-horse-popup .papa-horse-title {
            font-size: 26px;
            color: #fff;
            margin: 10px 0;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .papa-horse-popup .papa-horse-message {
            font-size: 20px;
            color: #333;
            background: rgba(255,255,255,0.5);
            padding: 10px 20px;
            border-radius: 15px;
        }

        /* ============ WIN SCREEN ============ */
        .win-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255, 182, 193, 0.98), rgba(255, 218, 185, 0.98));
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
        }

        .win-screen.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .win-title {
            font-size: 52px;
            color: #4A0080;
            text-shadow: 3px 3px 0 #FFD700;
            animation: winTitleBounce 0.5s ease-out infinite alternate;
            margin-bottom: 20px;
        }

        @keyframes winTitleBounce {
            from { transform: scale(1) rotate(-2deg); }
            to { transform: scale(1.05) rotate(2deg); }
        }

        .win-stars {
            font-size: 60px;
            margin: 20px 0;
        }

        .win-stars span {
            display: inline-block;
            animation: starPop 0.5s ease-out backwards;
        }

        .win-stars span:nth-child(1) { animation-delay: 0.2s; }
        .win-stars span:nth-child(2) { animation-delay: 0.4s; }
        .win-stars span:nth-child(3) { animation-delay: 0.6s; }

        @keyframes starPop {
            0% { transform: scale(0) rotate(-180deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        .win-message {
            font-size: 26px;
            color: #9370DB;
            margin: 20px 0;
        }

        .win-buttons {
            display: flex;
            gap: 20px;
            margin-top: 30px;
        }

        .win-button {
            padding: 18px 45px;
            font-size: 24px;
            border: none;
            border-radius: 35px;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            transition: transform 0.2s;
        }

        .win-button:hover {
            transform: scale(1.1) translateY(-5px);
        }

        .win-button.next-level {
            background: linear-gradient(135deg, #9370DB, #4A0080);
            color: white;
        }

        .win-button.play-again {
            background: linear-gradient(135deg, #FF69B4, #FFD700);
            color: white;
        }

        /* ============ COLLECTIBLE GEMS ============ */
        .gem {
            position: absolute;
            font-size: 30px;
            cursor: pointer;
            animation: gemFloat 2s ease-in-out infinite, gemGlow 1s ease-in-out infinite alternate;
            filter: drop-shadow(0 0 10px currentColor);
            z-index: 80;
        }

        @keyframes gemFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes gemGlow {
            from { filter: drop-shadow(0 0 5px currentColor); }
            to { filter: drop-shadow(0 0 20px currentColor); }
        }

        .gem.collected {
            animation: gemCollect 0.5s ease-out forwards;
            pointer-events: none;
        }

        @keyframes gemCollect {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 1; }
            100% { transform: scale(0) translateY(-50px); opacity: 0; }
        }

        /* ============ POWER-UPS ============ */
        .powerup {
            position: absolute;
            font-size: 40px;
            cursor: pointer;
            animation: powerupBounce 1s ease-in-out infinite;
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.3));
            z-index: 85;
        }

        @keyframes powerupBounce {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-15px) scale(1.1); }
        }

        .powerup.collected {
            animation: powerupCollect 0.6s ease-out forwards;
            pointer-events: none;
        }

        @keyframes powerupCollect {
            0% { transform: scale(1) rotate(0deg); opacity: 1; }
            100% { transform: scale(2) rotate(360deg); opacity: 0; }
        }

        /* Power-up active indicators */
        .powerup-active {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #FFD700, #FF69B4);
            color: #4A0080;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 22px;
            font-weight: bold;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 200;
            animation: powerupActiveGlow 0.5s ease-in-out infinite alternate;
        }

        @keyframes powerupActiveGlow {
            from { box-shadow: 0 5px 20px rgba(255, 215, 0, 0.5); }
            to { box-shadow: 0 5px 40px rgba(255, 105, 180, 0.8); }
        }

        /* ============ WALKING ANIMALS ============ */
        .walking-animal {
            position: absolute;
            bottom: 8%;
            font-size: 140px;
            z-index: 50;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .walking-animal:hover {
            transform: scale(1.3);
        }

        .animal-inner {
            display: inline-block;
            transition: transform 0.3s ease-out;
        }

        .walking-animal.walk-left {
            animation: walkLeft 25s linear forwards;
        }

        .walking-animal.walk-right {
            animation: walkRight 25s linear forwards;
        }

        @keyframes walkLeft {
            0% { left: 110%; transform: scaleX(1); }
            100% { left: -15%; transform: scaleX(1); }
        }

        @keyframes walkRight {
            0% { left: -15%; transform: scaleX(-1); }
            100% { left: 110%; transform: scaleX(-1); }
        }

        .walking-animal.bounce {
            animation-name: walkLeftBounce;
        }

        .walking-animal.walk-right.bounce {
            animation-name: walkRightBounce;
        }

        @keyframes walkLeftBounce {
            0% { left: 110%; transform: scaleX(1) translateY(0); }
            5% { transform: scaleX(1) translateY(-40px); }
            10% { transform: scaleX(1) translateY(0); }
            15% { transform: scaleX(1) translateY(-40px); }
            20% { transform: scaleX(1) translateY(0); }
            25% { transform: scaleX(1) translateY(-40px); }
            30% { transform: scaleX(1) translateY(0); }
            35% { transform: scaleX(1) translateY(-40px); }
            40% { transform: scaleX(1) translateY(0); }
            45% { transform: scaleX(1) translateY(-40px); }
            50% { transform: scaleX(1) translateY(0); }
            55% { transform: scaleX(1) translateY(-40px); }
            60% { transform: scaleX(1) translateY(0); }
            65% { transform: scaleX(1) translateY(-40px); }
            70% { transform: scaleX(1) translateY(0); }
            75% { transform: scaleX(1) translateY(-40px); }
            80% { transform: scaleX(1) translateY(0); }
            85% { transform: scaleX(1) translateY(-40px); }
            90% { transform: scaleX(1) translateY(0); }
            95% { transform: scaleX(1) translateY(-40px); }
            100% { left: -15%; transform: scaleX(1) translateY(0); }
        }

        @keyframes simpleBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-40px); }
        }

        @keyframes simpleBounceFlipped {
            0%, 100% { transform: scaleX(-1) translateY(0); }
            50% { transform: scaleX(-1) translateY(-40px); }
        }

        @keyframes walkRightBounce {
            0% { left: -15%; transform: scaleX(-1) translateY(0); }
            5% { transform: scaleX(-1) translateY(-40px); }
            10% { transform: scaleX(-1) translateY(0); }
            15% { transform: scaleX(-1) translateY(-40px); }
            20% { transform: scaleX(-1) translateY(0); }
            25% { transform: scaleX(-1) translateY(-40px); }
            30% { transform: scaleX(-1) translateY(0); }
            35% { transform: scaleX(-1) translateY(-40px); }
            40% { transform: scaleX(-1) translateY(0); }
            45% { transform: scaleX(-1) translateY(-40px); }
            50% { transform: scaleX(-1) translateY(0); }
            55% { transform: scaleX(-1) translateY(-40px); }
            60% { transform: scaleX(-1) translateY(0); }
            65% { transform: scaleX(-1) translateY(-40px); }
            70% { transform: scaleX(-1) translateY(0); }
            75% { transform: scaleX(-1) translateY(-40px); }
            80% { transform: scaleX(-1) translateY(0); }
            85% { transform: scaleX(-1) translateY(-40px); }
            90% { transform: scaleX(-1) translateY(0); }
            95% { transform: scaleX(-1) translateY(-40px); }
            100% { left: 110%; transform: scaleX(-1) translateY(0); }
        }

        /* Hatching Egg */
        .hatching-egg {
            position: absolute;
            bottom: 12%;
            font-size: 80px;
            z-index: 55;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .hatching-egg:hover {
            transform: scale(1.2);
        }

        .hatching-egg.wobble {
            animation: eggWobble 0.3s ease-in-out;
        }

        .hatching-egg.cracking {
            animation: eggCrack 0.5s ease-in-out forwards;
        }

        .hatching-egg.hatched {
            animation: eggHatch 0.8s ease-out forwards;
        }

        @keyframes eggWobble {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-10deg); }
            75% { transform: rotate(10deg); }
        }

        @keyframes eggCrack {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1.2); opacity: 0.8; }
        }

        @keyframes eggHatch {
            0% { transform: scale(1.2); opacity: 0.8; }
            50% { transform: scale(1.5) translateY(-20px); opacity: 0.5; }
            100% { transform: scale(0) translateY(-50px); opacity: 0; }
        }

        .baby-chicken {
            position: absolute;
            font-size: 60px;
            z-index: 56;
            cursor: pointer;
            animation: chickenBorn 0.5s ease-out forwards;
        }

        @keyframes chickenBorn {
            0% { transform: scale(0) translateY(20px); opacity: 0; }
            50% { transform: scale(1.3) translateY(-10px); opacity: 1; }
            100% { transform: scale(1) translateY(0); opacity: 1; }
        }

        .baby-chicken.walking {
            animation: chickenWalk 8s linear forwards;
        }

        @keyframes chickenWalk {
            0% { transform: translateX(0) translateY(0); }
            10% { transform: translateX(20px) translateY(-5px); }
            20% { transform: translateX(40px) translateY(0); }
            30% { transform: translateX(60px) translateY(-5px); }
            40% { transform: translateX(80px) translateY(0); }
            50% { transform: translateX(100px) translateY(-5px); }
            60% { transform: translateX(120px) translateY(0); }
            70% { transform: translateX(140px) translateY(-5px); }
            80% { transform: translateX(160px) translateY(0); }
            90% { transform: translateX(180px) translateY(-5px); }
            100% { transform: translateX(250px) translateY(0); opacity: 0; }
        }

        .ground {
            cursor: pointer;
        }

        /* ============ MOBILE ============ */
        @media (max-width: 768px) {
            .title-logo { font-size: 32px; }
            .start-button { font-size: 24px; padding: 15px 40px; }
            .game-title { font-size: 22px; top: 70px; }
            .character-frame { width: 80px; height: 80px; }
            .dog .character-frame { width: 100px; height: 100px; }
            .character-crown { font-size: 20px; }
            .character-name { font-size: 10px; }
            .castle { transform: scale(0.6); left: 5px; }
            .tree { transform: scale(0.6); }
            .pond { width: 320px; height: 160px; }
            .lily-pad { width: 35px; height: 28px; }
            .lily-pad.pad1 { top: 25px; left: 30px; }
            .lily-pad.pad2 { top: 50px; left: 120px; }
            .lily-pad.pad3 { top: 70px; left: 70px; }
            .level-display, .score-display, .butterfly-counter, .star-counter {
                font-size: 14px;
                padding: 8px 15px;
            }
            .win-title { font-size: 36px; }
            .win-button { padding: 12px 30px; font-size: 18px; }
            .walking-animal { font-size: 40px; }
            .walking-balloon { font-size: 45px; }
            .game-mode-btn { font-size: 20px; padding: 20px 30px; }
            .game-mode-btn .emoji { font-size: 40px; }
        }

        /* Very small phones */
        @media (max-width: 480px) {
            .character-frame { width: 60px; height: 60px; }
            .dog .character-frame { width: 80px; height: 80px; }
            .character-crown { font-size: 16px; top: -12px; }
            .character-name { font-size: 8px; padding: 2px 6px; }
            .castle { transform: scale(0.5); left: 0; }
            .tree { transform: scale(0.5); }
            .pond { width: 260px; height: 130px; right: 3%; }
            .sun { width: 70px; height: 70px; }
            .moon { width: 50px; height: 50px; }
            .walking-animal { font-size: 35px; }
            .walking-balloon { font-size: 40px; }
            .game-mode-title { font-size: 28px; }
            .game-mode-btn { font-size: 18px; padding: 15px 25px; }
            .game-mode-btn .emoji { font-size: 35px; }
        }
        /* ============ PASSWORD SCREEN ============ */
        .password-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .password-screen.hidden {
            display: none;
        }

        .password-title {
            font-size: 48px;
            color: white;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
            margin-bottom: 30px;
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }

        .password-subtitle {
            font-size: 24px;
            color: #FFD700;
            margin-bottom: 20px;
        }

        .password-input {
            font-size: 28px;
            padding: 15px 30px;
            border: 4px solid #FFD700;
            border-radius: 25px;
            text-align: center;
            outline: none;
            background: white;
            color: #4A0080;
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }

        .password-input::placeholder {
            color: #ccc;
        }

        .password-button {
            margin-top: 20px;
            font-size: 24px;
            padding: 15px 40px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border: none;
            border-radius: 30px;
            color: #4A0080;
            cursor: pointer;
            font-family: 'Comic Sans MS', cursive, sans-serif;
            font-weight: bold;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            transition: transform 0.2s;
        }

        .password-button:hover {
            transform: scale(1.1);
        }

        .password-error {
            color: #FF6B6B;
            font-size: 18px;
            margin-top: 15px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .password-error.visible {
            opacity: 1;
        }

        .password-hint {
            color: rgba(255,255,255,0.7);
            font-size: 16px;
            margin-top: 30px;
        }

        /* ============ GAME MODE MENU ============ */
        .game-mode-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9500;
        }

        .game-mode-menu.visible {
            display: flex;
        }

        .game-mode-title {
            font-size: 42px;
            color: white;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
            margin-bottom: 40px;
        }

        .game-mode-buttons {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .game-mode-btn {
            font-size: 28px;
            padding: 30px 50px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-family: 'Comic Sans MS', cursive;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .game-mode-btn:hover {
            transform: scale(1.1);
        }

        .game-mode-btn.animals {
            background: linear-gradient(135deg, #90EE90, #32CD32);
            color: #006400;
            box-shadow: 0 10px 30px rgba(50, 205, 50, 0.5);
        }

        .game-mode-btn.colors {
            background: linear-gradient(135deg, #FF69B4, #FF1493);
            color: white;
            box-shadow: 0 10px 30px rgba(255, 105, 180, 0.5);
        }

        .game-mode-btn .emoji {
            font-size: 60px;
        }

        /* Walking colored balloons */
        .walking-balloon {
            position: absolute;
            cursor: pointer;
            z-index: 100;
            transition: transform 0.2s;
            width: 90px;
            height: 140px;
        }

        .walking-balloon:hover {
            transform: scale(1.15);
        }

        .balloon-body {
            width: 90px;
            height: 110px;
            border-radius: 50% 50% 45% 45% / 55% 55% 45% 45%;
            position: relative;
            box-shadow: inset -15px -10px 30px rgba(255,255,255,0.5),
                        inset 8px 8px 20px rgba(0,0,0,0.15),
                        4px 6px 12px rgba(0,0,0,0.25);
        }

        /* Balloon shine/highlight */
        .balloon-body::before {
            content: '';
            position: absolute;
            top: 15%;
            left: 20%;
            width: 25px;
            height: 35px;
            background: rgba(255,255,255,0.4);
            border-radius: 50%;
            transform: rotate(-30deg);
        }

        /* Balloon knot */
        .balloon-knot {
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 12px;
            height: 12px;
            border-radius: 50% 50% 30% 30%;
        }

        .balloon-string {
            position: absolute;
            bottom: -45px;
            left: 50%;
            width: 3px;
            height: 40px;
            background: linear-gradient(to bottom, #888, #666);
            transform: translateX(-50%);
            border-radius: 2px;
        }

        /* Curvy string effect */
        .balloon-string::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: -3px;
            width: 10px;
            height: 10px;
            border: 2px solid #666;
            border-radius: 50%;
            border-top-color: transparent;
            border-left-color: transparent;
        }

        .walking-balloon.walk-left {
            animation: balloonFloatLeft 20s linear forwards;
        }

        .walking-balloon.walk-right {
            animation: balloonFloatRight 20s linear forwards;
        }

        @keyframes balloonFloatLeft {
            0% { left: 110%; transform: translateY(0); }
            25% { transform: translateY(-20px); }
            50% { transform: translateY(0); }
            75% { transform: translateY(-20px); }
            100% { left: -15%; transform: translateY(0); }
        }

        @keyframes balloonFloatRight {
            0% { left: -15%; transform: translateY(0); }
            25% { transform: translateY(-20px); }
            50% { transform: translateY(0); }
            75% { transform: translateY(-20px); }
            100% { left: 110%; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <!-- ============ PASSWORD SCREEN ============ -->
    <div class="password-screen" id="passwordScreen">
        <div class="password-title">üè∞ Princess Garden ü¶ã</div>
        <div class="password-subtitle">Enter the secret password:</div>
        <input type="password" class="password-input" id="passwordInput" placeholder="Password..." autocomplete="off">
        <button class="password-button" id="passwordButton">Enter üîë</button>
        <div class="password-error" id="passwordError">Wrong password! Try again.</div>
        <div class="password-hint">Hint: What's our puppy's name? üêï</div>
    </div>

    <!-- ============ GAME MODE MENU ============ -->
    <div class="game-mode-menu" id="gameModeMenu">
        <div class="game-mode-title">üéÆ Choose a Game! üéÆ</div>
        <div class="game-mode-buttons">
            <button class="game-mode-btn animals" id="btnAnimals">
                <span class="emoji">ü¶Åüêòü¶í</span>
                <span>Animals</span>
            </button>
            <button class="game-mode-btn colors" id="btnColors">
                <span class="emoji">üî¥üü¢üîµ</span>
                <span>Colors</span>
            </button>
        </div>
    </div>

    <!-- ============ TITLE SCREEN ============ -->
    <div class="title-screen" id="titleScreen">
        <div class="title-sparkles" id="titleSparkles"></div>
        <div class="title-logo">Princess Garden Adventure</div>
        <div class="title-characters">
            <div class="title-character"><img src="images/Ellie.jpeg" alt="Ellie"></div>
            <div class="title-character"><img src="images/Maya.jpeg" alt="Maya"></div>
            <div class="title-character"><img src="images/Pinky.jpeg" alt="Pinky"></div>
        </div>
        <div class="title-subtitle">Help the princesses catch Ms. Pinky!</div>
        <button class="start-button" id="startButton">Play!</button>
    </div>

    <!-- ============ STORY SCREEN ============ -->
    <div class="story-screen" id="storyScreen">
        <div class="story-text" id="storyText"></div>
        <div class="story-images" id="storyImages">
            <div class="story-image" id="storyImage1"></div>
            <div class="story-image" id="storyImage2"></div>
        </div>
        <button class="skip-button" id="skipStory">Skip</button>
    </div>

    <!-- ============ GAME CONTAINER ============ -->
    <div class="game-container" id="gameContainer">
        <!-- Menu Button -->
        <button class="menu-button" id="menuButton">üéÆ</button>
        <!-- Sky -->
        <div class="sky" id="sky"></div>
        <div class="sun" id="sun"></div>
        <div class="moon" id="moon"></div>
        <div class="cloud cloud-1" id="cloud1"></div>
        <div class="cloud cloud-2" id="cloud2"></div>
        <div class="cloud cloud-3" id="cloud3"></div>
        <div class="rainbow" id="rainbow">
            <div class="rainbow-arc"></div>
            <div class="rainbow-arc"></div>
            <div class="rainbow-arc"></div>
            <div class="rainbow-arc"></div>
            <div class="rainbow-arc"></div>
            <div class="rainbow-arc"></div>
            <div class="rainbow-arc"></div>
        </div>

        <!-- Ground -->
        <div class="ground" id="ground"></div>
        <div class="grass-container" id="grassContainer"></div>

        <!-- Castle -->
        <div class="castle" id="castle">
            <div class="castle-base">
                <div class="castle-tower">
                    <div class="castle-window"></div>
                </div>
                <div class="castle-tower main">
                    <div class="castle-window"></div>
                    <div class="castle-door"></div>
                </div>
                <div class="castle-tower">
                    <div class="castle-window"></div>
                </div>
            </div>
        </div>

        <!-- Tree -->
        <div class="tree" id="tree">
            <div class="tree-leaves"></div>
            <div class="tree-trunk"></div>
        </div>

        <!-- Pond -->
        <div class="pond" id="pond">
            <div class="pond-shine"></div>
            <div class="lily-pad pad1"></div>
            <div class="lily-pad pad2"></div>
            <div class="lily-pad pad3"></div>
            <div class="fish" id="fish">
                <div class="fish-body"></div>
                <div class="fish-tail"></div>
            </div>
        </div>

        <!-- Flowers -->
        <div class="flower flower-1" id="flower1">
            <div class="flower-stem"></div>
            <div class="flower-head">
                <div class="flower-petal" style="background: #FF69B4; transform: translate(-50%, -50%) translateX(-15px);"></div>
                <div class="flower-petal" style="background: #FF69B4; transform: translate(-50%, -50%) translateX(15px);"></div>
                <div class="flower-petal" style="background: #FF69B4; transform: translate(-50%, -50%) translateY(-15px);"></div>
                <div class="flower-petal" style="background: #FF69B4; transform: translate(-50%, -50%) translateY(15px);"></div>
                <div class="flower-center"></div>
            </div>
        </div>

        <div class="flower flower-2" id="flower2">
            <div class="flower-stem"></div>
            <div class="flower-head">
                <div class="flower-petal" style="background: #DDA0DD; transform: translate(-50%, -50%) translateX(-15px);"></div>
                <div class="flower-petal" style="background: #DDA0DD; transform: translate(-50%, -50%) translateX(15px);"></div>
                <div class="flower-petal" style="background: #DDA0DD; transform: translate(-50%, -50%) translateY(-15px);"></div>
                <div class="flower-petal" style="background: #DDA0DD; transform: translate(-50%, -50%) translateY(15px);"></div>
                <div class="flower-center"></div>
            </div>
        </div>

        <div class="flower flower-3" id="flower3">
            <div class="flower-stem"></div>
            <div class="flower-head">
                <div class="flower-petal" style="background: #87CEEB; transform: translate(-50%, -50%) translateX(-15px);"></div>
                <div class="flower-petal" style="background: #87CEEB; transform: translate(-50%, -50%) translateX(15px);"></div>
                <div class="flower-petal" style="background: #87CEEB; transform: translate(-50%, -50%) translateY(-15px);"></div>
                <div class="flower-petal" style="background: #87CEEB; transform: translate(-50%, -50%) translateY(15px);"></div>
                <div class="flower-center"></div>
            </div>
        </div>

        <div class="flower flower-4" id="flower4">
            <div class="flower-stem"></div>
            <div class="flower-head">
                <div class="flower-petal" style="background: #FFB6C1; transform: translate(-50%, -50%) translateX(-15px);"></div>
                <div class="flower-petal" style="background: #FFB6C1; transform: translate(-50%, -50%) translateX(15px);"></div>
                <div class="flower-petal" style="background: #FFB6C1; transform: translate(-50%, -50%) translateY(-15px);"></div>
                <div class="flower-petal" style="background: #FFB6C1; transform: translate(-50%, -50%) translateY(15px);"></div>
                <div class="flower-center"></div>
            </div>
        </div>

        <div class="flower flower-5" id="flower5">
            <div class="flower-stem"></div>
            <div class="flower-head">
                <div class="flower-petal" style="background: #98D8C8; transform: translate(-50%, -50%) translateX(-15px);"></div>
                <div class="flower-petal" style="background: #98D8C8; transform: translate(-50%, -50%) translateX(15px);"></div>
                <div class="flower-petal" style="background: #98D8C8; transform: translate(-50%, -50%) translateY(-15px);"></div>
                <div class="flower-petal" style="background: #98D8C8; transform: translate(-50%, -50%) translateY(15px);"></div>
                <div class="flower-center"></div>
            </div>
        </div>

        <!-- Characters -->
        <div class="character princess-1" id="princess1">
            <div class="character-wrapper">
                <div class="character-crown">üëë</div>
                <div class="character-frame">
                    <img src="images/Ellie.jpeg" alt="Princess Ellie">
                </div>
                <div class="character-name">Princess Ellie</div>
            </div>
        </div>

        <div class="character princess-2" id="princess2">
            <div class="character-wrapper">
                <div class="character-crown">üëë</div>
                <div class="character-frame">
                    <img src="images/Maya.jpeg" alt="Princess Maya">
                </div>
                <div class="character-name">Princess Maya</div>
            </div>
        </div>

        <div class="character dog" id="dog">
            <div class="character-wrapper">
                <div class="character-crown">üëë</div>
                <div class="dog-bow">üéÄ</div>
                <div class="character-frame">
                    <img src="images/Pinky.jpeg" alt="Ms. Pinky">
                </div>
                <div class="character-name">Ms. Pinky</div>
            </div>
        </div>

        <!-- UI -->
        <div class="game-ui">
            <div class="ui-left">
                <button class="sound-toggle" id="soundToggle">üîä</button>
                <button class="music-toggle" id="musicToggle">üéµ</button>
            </div>
            <div class="ui-right">
                <div class="level-display" id="levelDisplay">Level 1</div>
                <div class="score-display" id="scoreDisplay">üíé 0</div>
                <div class="butterfly-counter" id="butterflyCounter">ü¶ã 0 / 5</div>
                <div class="star-counter" id="starCounter">‚≠ê 0 / 5</div>
            </div>
        </div>

        <!-- Game Title -->
        <div class="game-title" id="gameTitle">‚ú® Princess Garden ‚ú®</div>

        <!-- Rain & Lightning -->
        <div class="rain-container" id="rainContainer"></div>
        <div class="lightning" id="lightning"></div>

        <!-- King Popup -->
        <div class="king-popup" id="kingPopup">
            <div class="king-crown">üëë</div>
            <div class="king-image"><img src="images/micha.jpeg" alt="King Papa Micha"></div>
            <div class="king-title">King Papa Micha</div>
            <div class="king-message" id="kingMessage">◊ê◊ô◊§◊î ◊î◊ë◊†◊ï◊™ ◊©◊ú◊ô? ◊ñ◊û◊ü ◊ú◊í◊ú◊ô◊ì◊î!</div>
        </div>

        <!-- Sana Popup -->
        <div class="sana-popup" id="sanaPopup">
            <div class="sana-emoji">üíï</div>
            <div class="sana-image"><img src="images/Oksana.jpeg" alt="Sana"></div>
            <div class="sana-title">Sana (Oksana)</div>
            <div class="sana-message" id="sanaMessage">–ì–¥–µ –º–æ—è –±—É—Å—è?</div>
        </div>

        <!-- Veronika Popup -->
        <div class="veronika-popup" id="veronikaPopup">
            <div class="veronika-emoji">üë©‚Äçüëß‚Äçüëß</div>
            <div class="veronika-image"><img src="images/Veronika.jpeg" alt="Mama Veronika"></div>
            <div class="veronika-title">Mama Veronika</div>
            <div class="veronika-message" id="veronikaMessage">–ü–∏–Ω–∫–∏, –ü–∏–Ω–∫–∏, –∏–¥–∏ –¥–æ–º–æ–π!</div>
        </div>

        <!-- Papa Micha Horse Popup -->
        <div class="papa-horse-popup" id="papaHorsePopup">
            <div class="papa-horse-emoji">üê¥üèá</div>
            <div class="papa-horse-image"><img src="images/micha2.jpg" alt="Papa Micha"></div>
            <div class="papa-horse-title">Papa Micha</div>
            <div class="papa-horse-message" id="papaHorseMessage">–õ–æ—à–∞–¥–∫–∞! ◊°◊ï◊°!</div>
        </div>
    </div>

    <!-- ============ INSTRUCTIONS POPUP ============ -->
    <div class="instructions-popup" id="instructionsPopup">
        <h2>How to Play!</h2>
        <div class="emoji-big">üå∏ ü¶ã üêï</div>
        <p><strong>Tap the flowers</strong> to release butterflies!</p>
        <p>The butterflies will fly to <strong>Ms. Pinky</strong></p>
        <p>Catch her with <strong>5 butterflies</strong> to win!</p>
        <p>Collect <strong>gems</strong> ‚≠ê for bonus points!</p>
        <button id="startGameBtn">Let's Go!</button>
    </div>

    <!-- ============ WIN SCREEN ============ -->
    <div class="win-screen" id="winScreen">
        <div class="win-title">Level Complete!</div>
        <div class="win-stars" id="winStars">
            <span>‚≠ê</span>
            <span>‚≠ê</span>
            <span>‚≠ê</span>
        </div>
        <div class="win-message" id="winMessage">You caught Ms. Pinky!</div>
        <div class="win-buttons">
            <button class="win-button next-level" id="nextLevelBtn">Next Level</button>
            <button class="win-button play-again" id="playAgainBtn">Play Again</button>
        </div>
    </div>

    <script>
        // ============ AUDIO SYSTEM ============
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx = null;
        let soundEnabled = true;
        let musicEnabled = true;
        let musicInterval = null;

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new AudioContext();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        function playTone(frequency, duration, type = 'sine', volume = 0.3) {
            if (!soundEnabled || !audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.frequency.value = frequency;
            osc.type = type;
            gain.gain.setValueAtTime(volume, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            osc.start(audioCtx.currentTime);
            osc.stop(audioCtx.currentTime + duration);
        }

        function playMagicSound() {
            playTone(523, 0.1);
            setTimeout(() => playTone(659, 0.1), 50);
            setTimeout(() => playTone(784, 0.15), 100);
        }

        function playCollectSound() {
            playTone(880, 0.1);
            setTimeout(() => playTone(1047, 0.15), 80);
        }

        function playSplashSound() {
            playTone(200, 0.2, 'triangle');
            setTimeout(() => playTone(150, 0.15, 'triangle'), 80);
        }

        function playBirdSound() {
            playTone(800, 0.08);
            setTimeout(() => playTone(1000, 0.08), 80);
            setTimeout(() => playTone(900, 0.1), 160);
        }

        function playHeartSound() {
            playTone(440, 0.12);
            setTimeout(() => playTone(554, 0.15), 80);
        }

        function playBarkSound() {
            playAudio('dog_sound.mp3');
        }

        function playThunderSound() {
            if (!audioCtx) return;
            const bufferSize = audioCtx.sampleRate * 0.6;
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) {
                data[i] = (Math.random() * 2 - 1) * Math.pow(1 - i / bufferSize, 1.5);
            }
            const noise = audioCtx.createBufferSource();
            noise.buffer = buffer;
            const filter = audioCtx.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.value = 150;
            const gain = audioCtx.createGain();
            gain.gain.setValueAtTime(0.4, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.6);
            noise.connect(filter);
            filter.connect(gain);
            gain.connect(audioCtx.destination);
            noise.start();
        }

        function playWinSound() {
            const notes = [523, 659, 784, 1047];
            notes.forEach((note, i) => {
                setTimeout(() => playTone(note, 0.3, 'sine', 0.25), i * 150);
            });
        }

        function playLevelUpSound() {
            const notes = [392, 523, 659, 784, 1047, 1319];
            notes.forEach((note, i) => {
                setTimeout(() => playTone(note, 0.2, 'sine', 0.2), i * 100);
            });
        }

        // Background Music - Soft music box lullaby style
        function playMusicBoxNote(frequency, duration) {
            if (!musicEnabled || !audioCtx) return;

            // Create a softer, music-box like sound
            const osc = audioCtx.createOscillator();
            const osc2 = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            const filter = audioCtx.createBiquadFilter();

            // Main tone
            osc.type = 'sine';
            osc.frequency.value = frequency;

            // Harmonic for richness
            osc2.type = 'sine';
            osc2.frequency.value = frequency * 2;

            // Soft filter
            filter.type = 'lowpass';
            filter.frequency.value = 2000;
            filter.Q.value = 1;

            osc.connect(filter);
            osc2.connect(filter);
            filter.connect(gain);
            gain.connect(audioCtx.destination);

            // Soft attack and decay like a music box
            gain.gain.setValueAtTime(0, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0.04, audioCtx.currentTime + 0.02);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);

            osc.start(audioCtx.currentTime);
            osc2.start(audioCtx.currentTime);
            osc.stop(audioCtx.currentTime + duration);
            osc2.stop(audioCtx.currentTime + duration);
        }

        // Playful xylophone sound for toddlers
        function playXylophoneNote(frequency, duration) {
            if (!musicEnabled || !audioCtx) return;

            const osc = audioCtx.createOscillator();
            const osc2 = audioCtx.createOscillator();
            const gain = audioCtx.createGain();

            // Bright, playful xylophone-like tone
            osc.type = 'sine';
            osc.frequency.value = frequency;
            osc2.type = 'sine';
            osc2.frequency.value = frequency * 4; // Bright overtone

            // Quick attack, gentle decay - like a xylophone
            gain.gain.setValueAtTime(0, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0.08, audioCtx.currentTime + 0.01);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);

            osc.connect(gain);
            osc2.connect(gain);
            gain.connect(audioCtx.destination);

            osc.start(audioCtx.currentTime);
            osc2.start(audioCtx.currentTime);
            osc.stop(audioCtx.currentTime + duration);
            osc2.stop(audioCtx.currentTime + duration);
        }

        function playBackgroundMusic() {
            if (!musicEnabled || !audioCtx) return;
            if (musicInterval) return; // Already playing

            // Fun, bouncy "Old MacDonald" style melody for toddlers
            const melody = [
                // "Old MacDonald had a farm" style bouncy tune
                { note: 392, dur: 0.4 }, // G4
                { note: 392, dur: 0.4 }, // G4
                { note: 392, dur: 0.4 }, // G4
                { note: 294, dur: 0.4 }, // D4
                { note: 330, dur: 0.4 }, // E4
                { note: 330, dur: 0.4 }, // E4
                { note: 294, dur: 0.8 }, // D4
                { note: 0, dur: 0.3 },   // rest
                { note: 494, dur: 0.4 }, // B4
                { note: 494, dur: 0.4 }, // B4
                { note: 440, dur: 0.4 }, // A4
                { note: 440, dur: 0.4 }, // A4
                { note: 392, dur: 0.8 }, // G4
                { note: 0, dur: 0.5 },   // rest
                // Second phrase - bouncy!
                { note: 294, dur: 0.3 }, // D4
                { note: 392, dur: 0.4 }, // G4
                { note: 392, dur: 0.4 }, // G4
                { note: 392, dur: 0.4 }, // G4
                { note: 294, dur: 0.4 }, // D4
                { note: 330, dur: 0.4 }, // E4
                { note: 330, dur: 0.4 }, // E4
                { note: 294, dur: 0.8 }, // D4
                { note: 0, dur: 0.3 },   // rest
                { note: 494, dur: 0.4 }, // B4
                { note: 494, dur: 0.4 }, // B4
                { note: 440, dur: 0.4 }, // A4
                { note: 440, dur: 0.4 }, // A4
                { note: 392, dur: 0.8 }, // G4
                { note: 0, dur: 0.6 },   // rest
                // Fun descending run
                { note: 523, dur: 0.25 }, // C5
                { note: 494, dur: 0.25 }, // B4
                { note: 440, dur: 0.25 }, // A4
                { note: 392, dur: 0.25 }, // G4
                { note: 349, dur: 0.25 }, // F4
                { note: 330, dur: 0.25 }, // E4
                { note: 294, dur: 0.25 }, // D4
                { note: 262, dur: 0.6 },  // C4
                { note: 0, dur: 0.8 },   // rest
            ];

            let noteIndex = 0;

            function playNextNote() {
                if (!musicEnabled) return;

                const { note, dur } = melody[noteIndex];
                if (note > 0) {
                    playXylophoneNote(note, dur * 0.85);
                }

                noteIndex = (noteIndex + 1) % melody.length;
                musicInterval = setTimeout(playNextNote, dur * 420); // Slightly faster tempo
            }

            playNextNote();
        }

        function stopBackgroundMusic() {
            if (musicInterval) {
                clearTimeout(musicInterval);
                musicInterval = null;
            }
        }

        // ElevenLabs Audio - Natural voice audio files
        const audioCache = {};

        function preloadAudio(filename) {
            if (!audioCache[filename]) {
                audioCache[filename] = new Audio(`audio/${filename}`);
                audioCache[filename].preload = 'auto';
            }
            return audioCache[filename];
        }

        function playAudio(filename) {
            if (!soundEnabled) return Promise.resolve();

            const audio = preloadAudio(filename);
            audio.currentTime = 0;
            return audio.play().catch(e => console.log('Audio play error:', e));
        }

        // Hebrew words mapping
        const hebrewWords = {
            flower: '◊§◊®◊ó',
            sun: '◊©◊û◊©',
            cloud: '◊¢◊†◊ü',
            rain: '◊í◊©◊ù',
            rainbow: '◊ß◊©◊™',
            tree: '◊¢◊•',
            pond: '◊ë◊®◊ô◊õ◊î',
            fish: '◊ì◊í',
            castle: '◊ò◊ô◊®◊î',
            home: '◊ë◊ô◊™',
            sky: '◊©◊û◊ô◊ô◊ù',
            grass: '◊ì◊©◊ê',
            moon: '◊ô◊®◊ó',
            butterfly: '◊§◊®◊§◊®',
            star: '◊õ◊ï◊õ◊ë',
            papa_horse: '◊ê◊ë◊ê ◊°◊ï◊°',
            elephant: '◊§◊ô◊ú',
            lion: '◊ê◊®◊ô◊î',
            bear: '◊ì◊ï◊ë',
            giraffe: '◊í◊≥◊ô◊®◊§◊î',
            zebra: '◊ñ◊ë◊®◊î',
            cow: '◊§◊®◊î',
            pig: '◊ó◊ñ◊ô◊®',
            sheep: '◊õ◊ë◊©◊î',
            goat: '◊¢◊ñ',
            deer: '◊ê◊ô◊ô◊ú',
            camel: '◊í◊û◊ú',
            kangaroo: '◊ß◊†◊í◊ï◊®◊ï',
            crocodile: '◊™◊†◊ô◊ü',
            hippo: '◊î◊ô◊§◊ï◊§◊ï◊ò◊ù',
            rhino: '◊ß◊®◊†◊£',
            tiger: '◊†◊û◊®',
            leopard: '◊ë◊®◊ì◊ú◊°',
            dog: '◊õ◊ú◊ë',
            cat: '◊ó◊™◊ï◊ú',
            chicken: '◊ê◊§◊®◊ï◊ó',
            duck: '◊ë◊®◊ï◊ï◊ñ',
            rabbit: '◊ê◊®◊†◊ë',
            fox: '◊©◊ï◊¢◊ú',
            squirrel: '◊°◊†◊ê◊ô',
            bird: '◊¶◊ô◊§◊ï◊®',
            princess_ellie: '◊î◊†◊°◊ô◊õ◊î ◊ê◊ú◊ô',
            princess_maya: '◊î◊†◊°◊ô◊õ◊î ◊û◊ê◊ô◊î',
            pinky: '◊î◊õ◊ú◊ë◊î ◊§◊ô◊†◊ß◊ô',
            // Colors
            red: '◊ê◊ì◊ï◊ù',
            blue: '◊õ◊ó◊ï◊ú',
            green: '◊ô◊®◊ï◊ß',
            yellow: '◊¶◊î◊ï◊ë',
            orange: '◊õ◊™◊ï◊ù',
            purple: '◊°◊í◊ï◊ú',
            pink: '◊ï◊®◊ï◊ì',
            white: '◊ú◊ë◊ü',
            black: '◊©◊ó◊ï◊®',
            brown: '◊ó◊ï◊ù'
        };

        // Bilingual audio - Russian (ElevenLabs) then Hebrew (Microsoft Edge TTS)
        function speakBilingual(wordKey, delay = 1200) {
            if (!soundEnabled) return;

            // Play Russian audio from ElevenLabs
            playAudio(`${wordKey}_ru.mp3`);

            // Then Hebrew audio from Microsoft Edge TTS
            setTimeout(() => {
                playAudio(`${wordKey}_he.mp3`);
            }, delay);
        }

        // Fallback speech synthesis for phrases not pre-recorded
        function speak(text, lang = 'en-US', rate = 1, pitch = 1.2) {
            if (!soundEnabled) return;
            speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = lang;
            utterance.rate = rate;
            utterance.pitch = pitch;
            speechSynthesis.speak(utterance);
        }

        // Preload all audio files
        function preloadAllAudio() {
            const words = ['flower', 'sun', 'cloud', 'rain', 'tree', 'pond', 'fish', 'castle', 'sky', 'grass',
                          'papa_horse', 'elephant', 'lion', 'bear', 'giraffe', 'zebra', 'cow', 'pig', 'sheep',
                          'goat', 'deer', 'camel', 'kangaroo', 'crocodile', 'hippo', 'rhino', 'tiger',
                          'leopard', 'dog', 'cat', 'rabbit', 'fox', 'squirrel', 'moon'];
            words.forEach(word => {
                preloadAudio(`${word}_ru.mp3`);
                preloadAudio(`${word}_he.mp3`);
            });
            // Extra audio files
            preloadAudio('princess_ellie_ru.mp3');
            preloadAudio('princess_ellie_he.mp3');
            preloadAudio('princess_maya_ru.mp3');
            preloadAudio('princess_maya_he.mp3');
            preloadAudio('maya_sana_ru.mp3');
            preloadAudio('maya_sana_he.mp3');
            preloadAudio('maya_boosa.mp3');
            preloadAudio('pinky_ru.mp3');
            preloadAudio('pinky_he.mp3');
            preloadAudio('papa_icecream_ru.mp3');
            preloadAudio('icecream_he.mp3');
            preloadAudio('papa_restaurant_ru.mp3');
            preloadAudio('restaurant_he.mp3');
            preloadAudio('sana_boosa_ru.mp3');
            preloadAudio('sana_boosa_he.mp3');
            preloadAudio('veronika_pinky_ru.mp3');
            preloadAudio('veronika_pinky_he.mp3');
            preloadAudio('home_ru.mp3');
            preloadAudio('home_he.mp3');
            // Colors
            const colors = ['red', 'blue', 'green', 'yellow', 'orange', 'purple', 'pink', 'white', 'black', 'brown'];
            colors.forEach(color => {
                preloadAudio(`${color}_ru.mp3`);
                preloadAudio(`${color}_he.mp3`);
            });
        }

        // ============ GAME STATE ============
        let gameState = {
            level: 1,
            score: 0,
            butterfliesCaught: 0,
            butterfliesNeeded: 5,
            starsCaught: 0,
            starsNeeded: 5,
            gameStarted: false,
            gamePaused: false,
            pinkySpeed: 1.5,
            gems: [],
            powerups: []
        };

        // Level configurations
        const levelConfig = {
            1: { butterflies: 5, pinkySpeed: 1.5, gems: 3, powerups: 1 },
            2: { butterflies: 7, pinkySpeed: 1.2, gems: 4, powerups: 1 },
            3: { butterflies: 10, pinkySpeed: 1, gems: 5, powerups: 2 },
            4: { butterflies: 12, pinkySpeed: 0.8, gems: 6, powerups: 2 },
            5: { butterflies: 15, pinkySpeed: 0.6, gems: 8, powerups: 3 }
        };

        // ============ VISUAL EFFECTS ============
        function createSparkle(x, y, color = null) {
            const sparkle = document.createElement('div');
            sparkle.className = 'sparkle';
            sparkle.style.left = x + 'px';
            sparkle.style.top = y + 'px';
            sparkle.style.color = color || ['#FFD700', '#FF69B4', '#87CEEB', '#DDA0DD', '#98D8C8'][Math.floor(Math.random() * 5)];
            document.body.appendChild(sparkle);
            setTimeout(() => sparkle.remove(), 800);
        }

        function createSparkles(x, y, count = 8) {
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    createSparkle(
                        x + (Math.random() - 0.5) * 60,
                        y + (Math.random() - 0.5) * 60
                    );
                }, i * 40);
            }
        }

        function createHeart(x, y) {
            const heart = document.createElement('div');
            heart.className = 'heart';
            heart.textContent = ['‚ù§Ô∏è', 'üíñ', 'üíï', 'üíó', 'üíù'][Math.floor(Math.random() * 5)];
            heart.style.left = x + 'px';
            heart.style.top = y + 'px';
            document.body.appendChild(heart);
            setTimeout(() => heart.remove(), 1500);
        }

        function createFloatingHearts() {
            const hearts = ['‚ù§Ô∏è', 'üíñ', 'üíï', 'üíó', 'üíù', 'ü©∑', 'üíú', 'ü©µ'];
            const isDesktop = window.innerWidth > 768;
            const baseSize = isDesktop ? 100 : 50;
            const sizeVariation = isDesktop ? 80 : 40;
            const heartCount = isDesktop ? 12 : 8;

            for (let i = 0; i < heartCount; i++) {
                setTimeout(() => {
                    const heart = document.createElement('div');
                    heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
                    heart.style.cssText = `
                        position: fixed;
                        font-size: ${baseSize + Math.random() * sizeVariation}px;
                        left: ${10 + Math.random() * 80}%;
                        bottom: -60px;
                        z-index: 200;
                        pointer-events: none;
                        animation: floatUpHeart ${3 + Math.random() * 2}s ease-out forwards;
                    `;
                    document.body.appendChild(heart);
                    setTimeout(() => heart.remove(), 5000);
                }, i * 150);
            }
        }

        function createBird(x, y) {
            const bird = document.createElement('div');
            bird.className = 'bird';
            bird.textContent = ['üê¶', 'üê§', 'ü¶ú'][Math.floor(Math.random() * 3)];
            bird.style.left = x + 'px';
            bird.style.top = y + 'px';
            document.body.appendChild(bird);
            playBirdSound();
            setTimeout(() => bird.remove(), 3000);
        }

        function createButterfly(x, y, targetX, targetY, onReach) {
            const butterfly = document.createElement('div');
            butterfly.className = 'butterfly';
            butterfly.style.left = x + 'px';
            butterfly.style.top = y + 'px';

            const colors = [
                { primary: '#FF69B4', secondary: '#FF1493' },
                { primary: '#DDA0DD', secondary: '#BA55D3' },
                { primary: '#87CEEB', secondary: '#4169E1' },
                { primary: '#FFB6C1', secondary: '#FF6B8A' },
                { primary: '#98D8C8', secondary: '#20B2AA' },
                { primary: '#FFD700', secondary: '#FFA500' }
            ];
            const colorSet = colors[Math.floor(Math.random() * colors.length)];
            butterfly.innerHTML = `
                <div class="butterfly-antenna left-antenna"></div>
                <div class="butterfly-antenna right-antenna"></div>
                <div class="butterfly-body"></div>
                <div class="butterfly-wing top-left" style="background: linear-gradient(135deg, ${colorSet.primary}, ${colorSet.secondary});"><div class="wing-spot" style="width: 6px; height: 6px; top: 4px; left: 4px;"></div></div>
                <div class="butterfly-wing top-right" style="background: linear-gradient(225deg, ${colorSet.primary}, ${colorSet.secondary});"><div class="wing-spot" style="width: 6px; height: 6px; top: 4px; right: 4px;"></div></div>
                <div class="butterfly-wing bottom-left" style="background: linear-gradient(135deg, ${colorSet.secondary}, ${colorSet.primary});"></div>
                <div class="butterfly-wing bottom-right" style="background: linear-gradient(225deg, ${colorSet.secondary}, ${colorSet.primary});"></div>
            `;

            // Add click handler to say butterfly in Russian/Hebrew and give 1 point
            butterfly.addEventListener('click', (e) => {
                e.stopPropagation();
                initAudio();
                speakBilingual('butterfly');
                createSparkles(e.clientX, e.clientY);
                playMagicSound();
                gameState.score += 1;
                gameState.butterfliesCaught++;
                updateUI();
                checkWinCondition();
            });

            document.body.appendChild(butterfly);

            // Animate to target
            butterfly.style.transition = `left ${gameState.pinkySpeed}s ease-in-out, top ${gameState.pinkySpeed}s ease-in-out`;

            setTimeout(() => {
                butterfly.style.left = targetX + 'px';
                butterfly.style.top = targetY + 'px';
            }, 50);

            setTimeout(() => {
                butterfly.remove();
                if (onReach) onReach();
            }, gameState.pinkySpeed * 1000);
        }

        // Spawn decorative butterflies that float around
        function spawnDecorativeButterfly() {
            const butterfly = document.createElement('div');
            butterfly.className = 'butterfly decorative-butterfly';

            const colors = [
                { primary: '#FF69B4', secondary: '#FF1493' },
                { primary: '#DDA0DD', secondary: '#BA55D3' },
                { primary: '#87CEEB', secondary: '#4169E1' },
                { primary: '#FFB6C1', secondary: '#FF6B8A' },
                { primary: '#98D8C8', secondary: '#20B2AA' },
                { primary: '#FFD700', secondary: '#FFA500' }
            ];
            const colorSet = colors[Math.floor(Math.random() * colors.length)];
            butterfly.innerHTML = `
                <div class="butterfly-antenna left-antenna"></div>
                <div class="butterfly-antenna right-antenna"></div>
                <div class="butterfly-body"></div>
                <div class="butterfly-wing top-left" style="background: linear-gradient(135deg, ${colorSet.primary}, ${colorSet.secondary});"><div class="wing-spot" style="width: 6px; height: 6px; top: 4px; left: 4px;"></div></div>
                <div class="butterfly-wing top-right" style="background: linear-gradient(225deg, ${colorSet.primary}, ${colorSet.secondary});"><div class="wing-spot" style="width: 6px; height: 6px; top: 4px; right: 4px;"></div></div>
                <div class="butterfly-wing bottom-left" style="background: linear-gradient(135deg, ${colorSet.secondary}, ${colorSet.primary});"></div>
                <div class="butterfly-wing bottom-right" style="background: linear-gradient(225deg, ${colorSet.secondary}, ${colorSet.primary});"></div>
            `;

            // Random position in the sky area only
            butterfly.style.left = (10 + Math.random() * 80) + '%';
            butterfly.style.top = (5 + Math.random() * 20) + '%';

            // Add click handler - give 1 point, disappear and spawn new one
            butterfly.addEventListener('click', (e) => {
                e.stopPropagation();
                initAudio();
                speakBilingual('butterfly');
                createSparkles(e.clientX, e.clientY);
                playMagicSound();
                gameState.score += 1;
                gameState.butterfliesCaught++;
                updateUI();
                checkWinCondition();

                // Butterfly disappears
                butterfly.style.transition = 'transform 0.3s, opacity 0.3s';
                butterfly.style.transform = 'scale(0)';
                butterfly.style.opacity = '0';
                setTimeout(() => {
                    butterfly.remove();
                    // Spawn new butterfly after delay
                    setTimeout(() => spawnDecorativeButterfly(), 2000 + Math.random() * 2000);
                }, 300);
            });

            document.getElementById('gameContainer').appendChild(butterfly);

            // Flutter around randomly
            function flutter() {
                if (!butterfly.parentNode) return;
                const newX = Math.max(5, Math.min(90, parseFloat(butterfly.style.left) + (Math.random() - 0.5) * 20));
                const newY = Math.max(5, Math.min(25, parseFloat(butterfly.style.top) + (Math.random() - 0.5) * 10));
                butterfly.style.transition = 'left 3s ease-in-out, top 3s ease-in-out';
                butterfly.style.left = newX + '%';
                butterfly.style.top = newY + '%';
                setTimeout(flutter, 3000 + Math.random() * 2000);
            }
            setTimeout(flutter, 1000);

            // Remove after some time
            setTimeout(() => butterfly.remove(), 30000);
        }

        // Create a single clickable star in the sky
        function spawnStar() {
            const container = document.getElementById('gameContainer');
            const starEmojis = ['‚≠ê', 'üåü', '‚ú®'];

            const star = document.createElement('div');
            star.className = 'clickable-star';
            star.textContent = starEmojis[Math.floor(Math.random() * starEmojis.length)];

            // Position ONLY in the sky area (top 25% of screen)
            star.style.left = (5 + Math.random() * 90) + '%';
            star.style.top = (3 + Math.random() * 22) + '%';
            star.style.animationDelay = (Math.random() * 2) + 's';

            // Add click handler - star gives 1 point, disappears and new one spawns later
            star.addEventListener('click', (e) => {
                e.stopPropagation();
                initAudio();
                speakBilingual('star');
                createSparkles(e.clientX, e.clientY);
                playMagicSound();
                gameState.score += 1;
                gameState.starsCaught++;
                updateUI();
                checkWinCondition();

                // Remove star with fade effect
                star.style.transition = 'opacity 0.3s, transform 0.3s';
                star.style.opacity = '0';
                star.style.transform = 'scale(2)';
                setTimeout(() => {
                    star.remove();
                    // Spawn a new star after 3-6 seconds
                    setTimeout(() => spawnStar(), 3000 + Math.random() * 3000);
                }, 300);
            });

            container.appendChild(star);
        }

        // Create initial clickable stars in the sky
        function createClickableStars() {
            // Create 5-7 clickable stars
            const numStars = 5 + Math.floor(Math.random() * 3);
            for (let i = 0; i < numStars; i++) {
                setTimeout(() => spawnStar(), i * 500);
            }
        }

        // Schedule periodic butterfly spawning
        function scheduleButterflies() {
            // Spawn initial butterflies
            for (let i = 0; i < 2; i++) {
                setTimeout(() => spawnDecorativeButterfly(), i * 2000);
            }

            // Spawn new butterfly every 15-20 seconds
            setInterval(() => {
                if (document.querySelectorAll('.decorative-butterfly').length < 4) {
                    spawnDecorativeButterfly();
                }
            }, 15000 + Math.random() * 5000);
        }

        // Spawn a flying bird that crosses the sky
        function spawnFlyingBird() {
            const birdEmojis = ['üê¶', 'ü¶Ö', 'ü¶ú', 'üïäÔ∏è'];
            const bird = document.createElement('div');
            bird.className = 'flying-bird';
            const selectedBird = birdEmojis[Math.floor(Math.random() * birdEmojis.length)];
            bird.textContent = selectedBird;

            const goRight = Math.random() > 0.5;
            bird.classList.add(goRight ? 'fly-right' : 'fly-left');

            // Dove flies slower
            if (selectedBird === 'üïäÔ∏è') {
                bird.classList.add('slow-bird');
            }

            // Click handler - say bird in Russian/Hebrew
            bird.addEventListener('click', (e) => {
                e.stopPropagation();
                initAudio();
                speakBilingual('bird');
                createSparkles(e.clientX, e.clientY);
                playBirdSound();
                // Get current position and fly off fast
                const rect = bird.getBoundingClientRect();
                bird.style.left = rect.left + 'px';
                bird.style.top = rect.top + 'px';
                bird.style.pointerEvents = 'none';
                // Trigger fly-off
                requestAnimationFrame(() => {
                    bird.classList.add('caught');
                });
                setTimeout(() => bird.remove(), 600);
            });

            document.body.appendChild(bird);

            // Remove after animation completes (30s for slow birds + buffer)
            setTimeout(() => bird.remove(), 32000);
        }

        // Schedule periodic flying birds
        function scheduleFlyingBirds() {
            // First bird after 5 seconds
            setTimeout(spawnFlyingBird, 5000);

            // Then spawn a bird every 8-15 seconds
            setInterval(() => {
                spawnFlyingBird();
            }, 8000 + Math.random() * 7000);
        }

        function makeItRain() {
            const container = document.getElementById('rainContainer');
            for (let i = 0; i < 60; i++) {
                setTimeout(() => {
                    const drop = document.createElement('div');
                    drop.className = 'raindrop';
                    drop.style.left = Math.random() * 100 + '%';
                    drop.style.animationDuration = (0.4 + Math.random() * 0.3) + 's';
                    container.appendChild(drop);
                    setTimeout(() => drop.remove(), 700);
                }, i * 15);
            }
        }

        function makeLightning() {
            const lightning = document.getElementById('lightning');
            lightning.classList.remove('flash');
            void lightning.offsetWidth;
            lightning.classList.add('flash');
            if (soundEnabled) playThunderSound();
        }

        // ============ GRASS GENERATION ============
        function generateGrass() {
            const container = document.getElementById('grassContainer');
            container.innerHTML = '';
            const bladeCount = Math.floor(window.innerWidth / 12);
            for (let i = 0; i < bladeCount; i++) {
                const blade = document.createElement('div');
                blade.className = 'grass-blade';
                blade.style.left = (i * 12 + Math.random() * 6) + 'px';
                blade.style.height = (30 + Math.random() * 25) + 'px';
                blade.style.animationDelay = (Math.random() * 2) + 's';
                container.appendChild(blade);
            }
        }

        // ============ TITLE SCREEN SPARKLES ============
        function createTitleSparkles() {
            const container = document.getElementById('titleSparkles');
            const sparkles = ['‚ú®', '‚≠ê', 'üí´', 'üåü', 'üíñ'];
            for (let i = 0; i < 15; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'title-sparkle';
                sparkle.textContent = sparkles[Math.floor(Math.random() * sparkles.length)];
                sparkle.style.left = Math.random() * 100 + '%';
                sparkle.style.top = Math.random() * 100 + '%';
                sparkle.style.animationDelay = (Math.random() * 4) + 's';
                container.appendChild(sparkle);
            }
        }

        // ============ COLLECTIBLES ============
        function spawnGems() {
            // Remove existing gems
            document.querySelectorAll('.gem').forEach(g => g.remove());
            gameState.gems = [];

            const config = levelConfig[gameState.level] || levelConfig[5];
            const gemTypes = ['üíé', 'üåü', '‚≠ê', 'üí´'];

            for (let i = 0; i < config.gems; i++) {
                const gem = document.createElement('div');
                gem.className = 'gem';
                gem.textContent = gemTypes[Math.floor(Math.random() * gemTypes.length)];
                gem.style.left = (15 + Math.random() * 70) + '%';
                gem.style.bottom = (15 + Math.random() * 25) + '%';
                gem.style.animationDelay = (Math.random() * 2) + 's';
                gem.dataset.points = 10 + Math.floor(Math.random() * 20);

                gem.addEventListener('click', () => collectGem(gem));
                gem.addEventListener('touchstart', (e) => { e.preventDefault(); collectGem(gem); });

                document.getElementById('gameContainer').appendChild(gem);
                gameState.gems.push(gem);
            }
        }

        function collectGem(gem) {
            if (gem.classList.contains('collected')) return;
            gem.classList.add('collected');

            const points = parseInt(gem.dataset.points);
            gameState.score += points;
            updateUI();

            playCollectSound();
            const rect = gem.getBoundingClientRect();
            createSparkles(rect.left + rect.width/2, rect.top + rect.height/2, 10);

            setTimeout(() => gem.remove(), 500);
        }

        function spawnPowerups() {
            document.querySelectorAll('.powerup').forEach(p => p.remove());

            const config = levelConfig[gameState.level] || levelConfig[5];
            const powerupTypes = [
                { emoji: '‚ö°', effect: 'speed', name: 'Super Speed!' },
                { emoji: '‚ùÑÔ∏è', effect: 'freeze', name: 'Freeze Pinky!' },
                { emoji: 'ü¶ã', effect: 'multifly', name: 'Triple Butterflies!' }
            ];

            for (let i = 0; i < config.powerups; i++) {
                setTimeout(() => {
                    if (!gameState.gameStarted) return;

                    const type = powerupTypes[Math.floor(Math.random() * powerupTypes.length)];
                    const powerup = document.createElement('div');
                    powerup.className = 'powerup';
                    powerup.textContent = type.emoji;
                    powerup.style.left = (20 + Math.random() * 60) + '%';
                    powerup.style.bottom = (45 + Math.random() * 10) + '%';
                    powerup.dataset.effect = type.effect;
                    powerup.dataset.name = type.name;

                    powerup.addEventListener('click', () => collectPowerup(powerup));
                    powerup.addEventListener('touchstart', (e) => { e.preventDefault(); collectPowerup(powerup); });

                    document.getElementById('gameContainer').appendChild(powerup);
                }, 5000 + i * 10000);
            }
        }

        function collectPowerup(powerup) {
            if (powerup.classList.contains('collected')) return;
            powerup.classList.add('collected');

            const effect = powerup.dataset.effect;
            const name = powerup.dataset.name;

            playLevelUpSound();
            const rect = powerup.getBoundingClientRect();
            createSparkles(rect.left, rect.top, 15);

            // Show powerup notification
            showPowerupActive(name);

            // Apply effect
            switch (effect) {
                case 'speed':
                    const oldSpeed = gameState.pinkySpeed;
                    gameState.pinkySpeed = 0.5;
                    setTimeout(() => gameState.pinkySpeed = oldSpeed, 5000);
                    break;
                case 'freeze':
                    const dog = document.getElementById('dog');
                    dog.style.transition = 'none';
                    setTimeout(() => dog.style.transition = '', 4000);
                    break;
                case 'multifly':
                    // Next 3 flower clicks spawn 3 butterflies
                    window.multiflyCount = 3;
                    break;
            }

            setTimeout(() => powerup.remove(), 600);
        }

        function showPowerupActive(name) {
            const existing = document.querySelector('.powerup-active');
            if (existing) existing.remove();

            const indicator = document.createElement('div');
            indicator.className = 'powerup-active';
            indicator.textContent = name;
            document.body.appendChild(indicator);

            setTimeout(() => indicator.remove(), 3000);
        }

        // ============ CHARACTER MOVEMENT ============
        function movePinkyRandomly() {
            if (!gameState.gameStarted || gameState.gamePaused) return;

            const dog = document.getElementById('dog');
            const newLeft = 20 + Math.random() * 55;
            const newBottom = 10 + Math.random() * 20;

            dog.style.left = newLeft + '%';
            dog.style.transform = 'none';
            dog.style.bottom = newBottom + '%';
        }

        function startPinkyMovement() {
            setInterval(() => {
                if (gameState.gameStarted && !gameState.gamePaused) {
                    movePinkyRandomly();
                }
            }, 3000 + Math.random() * 2000);
        }

        // Princess movement - they run around too!
        function movePrincess1Randomly() {
            if (!gameState.gameStarted || gameState.gamePaused) return;

            const princess = document.getElementById('princess1');
            const newLeft = 10 + Math.random() * 35; // Left side area
            const newBottom = 12 + Math.random() * 18;

            princess.style.left = newLeft + '%';
            princess.style.bottom = newBottom + '%';
        }

        function movePrincess2Randomly() {
            if (!gameState.gameStarted || gameState.gamePaused) return;

            const princess = document.getElementById('princess2');
            const newLeft = 30 + Math.random() * 35; // Middle area
            const newBottom = 14 + Math.random() * 18;

            princess.style.left = newLeft + '%';
            princess.style.bottom = newBottom + '%';
        }

        function animatePrincesses() {
            // Princess 1 moves every 4-6 seconds
            setInterval(() => {
                if (gameState.gameStarted && !gameState.gamePaused) {
                    movePrincess1Randomly();
                }
            }, 4000 + Math.random() * 2000);

            // Princess 2 moves every 3-5 seconds (slightly different timing)
            setInterval(() => {
                if (gameState.gameStarted && !gameState.gamePaused) {
                    movePrincess2Randomly();
                }
            }, 3500 + Math.random() * 2000);
        }

        // ============ FAMILY POPUPS ============
        function showKingPopup(message) {
            const popup = document.getElementById('kingPopup');
            const messageEl = document.getElementById('kingMessage');
            messageEl.textContent = message || '–ì–¥–µ –º–æ–∏ –¥–µ–≤–æ—á–∫–∏?';
            popup.classList.add('visible');
            setTimeout(() => popup.classList.remove('visible'), 4000);
        }

        function showSanaPopup() {
            const popup = document.getElementById('sanaPopup');
            popup.classList.add('visible');
            setTimeout(() => popup.classList.remove('visible'), 4000);
        }

        function showVeronikaPopup() {
            const popup = document.getElementById('veronikaPopup');
            popup.classList.add('visible');
            setTimeout(() => popup.classList.remove('visible'), 4000);
        }

        function showPapaHorsePopup(x, y) {
            const popup = document.getElementById('papaHorsePopup');
            // Position near the horse
            popup.style.position = 'fixed';
            popup.style.left = Math.min(x, window.innerWidth - 250) + 'px';
            popup.style.top = Math.max(y - 200, 50) + 'px';
            popup.style.transform = ''; // Clear inline transform so CSS can take over
            popup.classList.add('visible');
            setTimeout(() => popup.classList.remove('visible'), 3000);
        }

        // ============ WALKING ANIMALS ============
        const animals = [
            { emoji: 'üê¥', audioKey: 'papa_horse', soundFile: 'horse_sound.mp3' },
            { emoji: 'üêò', audioKey: 'elephant', soundFile: 'elephant_sound.mp3' },
            { emoji: 'ü¶Å', audioKey: 'lion', soundFile: 'lion_sound.mp3' },
            { emoji: 'üêª', audioKey: 'bear', soundFile: 'bear_sound.mp3' },
            { emoji: 'ü¶í', audioKey: 'giraffe', soundFile: 'giraffe_sound.mp3' },
            { emoji: 'ü¶ì', audioKey: 'zebra', soundFile: 'zebra_sound.mp3' },
            { emoji: 'üêÑ', audioKey: 'cow', soundFile: 'cow_sound.mp3' },
            { emoji: 'üê∑', audioKey: 'pig', soundFile: 'pig_sound.mp3' },
            { emoji: 'üêë', audioKey: 'sheep', soundFile: 'sheep_sound.mp3' },
            { emoji: 'üêê', audioKey: 'goat', soundFile: 'goat_sound.mp3' },
            { emoji: 'ü¶å', audioKey: 'deer', soundFile: 'deer_sound.mp3' },
            { emoji: 'üê™', audioKey: 'camel', soundFile: 'camel_sound.mp3' },
            { emoji: 'ü¶ò', audioKey: 'kangaroo', soundFile: 'kangaroo_sound.mp3' },
            { emoji: 'üêä', audioKey: 'crocodile', soundFile: 'crocodile_sound.mp3' },
            { emoji: 'ü¶õ', audioKey: 'hippo', soundFile: 'hippo_sound.mp3' },
            { emoji: 'ü¶è', audioKey: 'rhino', soundFile: 'rhino_sound.mp3' },
            { emoji: 'üêÖ', audioKey: 'tiger', soundFile: 'lion_sound.mp3' },
            { emoji: 'üêÜ', audioKey: 'leopard', soundFile: 'lion_sound.mp3' },
            { emoji: 'üêï', audioKey: 'dog', soundFile: 'dog_sound.mp3' },
            { emoji: 'üêà', audioKey: 'cat', soundFile: 'cat_sound.mp3' },
            { emoji: 'üêá', audioKey: 'rabbit', soundFile: 'rabbit_sound.mp3' },
            { emoji: 'ü¶ä', audioKey: 'fox', soundFile: 'fox_sound.mp3' },
            { emoji: 'üêøÔ∏è', audioKey: 'squirrel', soundFile: 'squirrel_sound.mp3' },
        ];

        // ============ COLORS FOR COLOR GAME ============
        let currentGameMode = 'animals'; // 'animals' or 'colors'

        const colorItems = [
            { audioKey: 'red', color: '#FF0000' },
            { audioKey: 'blue', color: '#0066FF' },
            { audioKey: 'green', color: '#00CC00' },
            { audioKey: 'yellow', color: '#FFD700' },
            { audioKey: 'orange', color: '#FF6600' },
            { audioKey: 'purple', color: '#9900CC' },
            { audioKey: 'pink', color: '#FF69B4' },
            { audioKey: 'white', color: '#FFFFFF' },
            { audioKey: 'black', color: '#222222' },
            { audioKey: 'brown', color: '#8B4513' },
        ];

        let lastBalloonColor = null; // Track last color to prevent repeats

        function spawnColorBalloon(colorData, direction = 'random') {
            const container = document.getElementById('gameContainer');
            const balloon = document.createElement('div');
            balloon.className = 'walking-balloon';

            // Create CSS balloon with actual color
            const balloonBody = document.createElement('div');
            balloonBody.className = 'balloon-body';
            balloonBody.style.backgroundColor = colorData.color;

            // Add balloon knot
            const balloonKnot = document.createElement('div');
            balloonKnot.className = 'balloon-knot';
            balloonKnot.style.backgroundColor = colorData.color;

            const balloonString = document.createElement('div');
            balloonString.className = 'balloon-string';

            balloon.appendChild(balloonBody);
            balloon.appendChild(balloonKnot);
            balloon.appendChild(balloonString);

            const goRight = direction === 'random' ? Math.random() > 0.5 : direction === 'right';
            balloon.classList.add(goRight ? 'walk-right' : 'walk-left');

            // Random vertical position in sky area
            balloon.style.top = (10 + Math.random() * 30) + '%';

            balloon.addEventListener('click', (e) => {
                initAudio();
                speakBilingual(colorData.audioKey);
                createSparkles(e.clientX, e.clientY);
                playMagicSound();

                // Pop the balloon
                balloon.style.transition = 'transform 0.2s, opacity 0.2s';
                balloon.style.transform = 'scale(1.5)';
                balloon.style.opacity = '0';
                setTimeout(() => balloon.remove(), 200);
            });

            container.appendChild(balloon);
            makeBalloonDraggable(balloon);

            // Remove after animation
            setTimeout(() => balloon.remove(), 21000);
        }

        function makeBalloonDraggable(element) {
            let isDragging = false;
            let startX, startY, startLeft, startTop;
            let wasGoingRight = false;

            function startDrag(clientX, clientY) {
                isDragging = true;
                startX = clientX;
                startY = clientY;
                const rect = element.getBoundingClientRect();
                const container = document.getElementById('gameContainer').getBoundingClientRect();
                startLeft = rect.left - container.left;
                startTop = rect.top - container.top;
                wasGoingRight = element.classList.contains('walk-right');
                element.style.animation = 'none';
                element.style.left = startLeft + 'px';
                element.style.top = startTop + 'px';
            }

            function moveDrag(clientX, clientY, e) {
                if (!isDragging) return;
                const deltaX = clientX - startX;
                const deltaY = clientY - startY;
                if (Math.abs(deltaX) > 5 || Math.abs(deltaY) > 5) {
                    if (e) e.preventDefault();
                    const container = document.getElementById('gameContainer').getBoundingClientRect();
                    const newLeft = Math.max(0, Math.min(container.width - 60, startLeft + deltaX));
                    const newTop = Math.max(0, Math.min(container.height * 0.5, startTop + deltaY));
                    element.style.left = newLeft + 'px';
                    element.style.top = newTop + 'px';
                }
            }

            function endDrag() {
                if (!isDragging) return;
                isDragging = false;
                const container = document.getElementById('gameContainer').getBoundingClientRect();
                const rect = element.getBoundingClientRect();
                const currentLeft = rect.left - container.left;
                const currentLeftPercent = (currentLeft / container.width) * 100;

                let targetLeft = wasGoingRight ? '110%' : '-15%';
                const remainingDistance = wasGoingRight ? (110 - currentLeftPercent) / 125 : (currentLeftPercent + 15) / 125;
                const remainingTime = Math.max(2, remainingDistance * 20);

                element.style.transition = `left ${remainingTime}s linear`;
                requestAnimationFrame(() => {
                    element.style.left = targetLeft;
                });
            }

            element.addEventListener('touchstart', (e) => startDrag(e.touches[0].clientX, e.touches[0].clientY), { passive: true });
            element.addEventListener('touchmove', (e) => moveDrag(e.touches[0].clientX, e.touches[0].clientY, e), { passive: false });
            element.addEventListener('touchend', endDrag);
            element.addEventListener('mousedown', (e) => { e.preventDefault(); startDrag(e.clientX, e.clientY); });
            document.addEventListener('mousemove', (e) => moveDrag(e.clientX, e.clientY, e));
            document.addEventListener('mouseup', endDrag);
        }

        function scheduleColors() {
            if (!gameState.gameStarted || currentGameMode !== 'colors') return;

            function getRandomColorDifferentFromLast() {
                let colorData;
                let attempts = 0;
                do {
                    colorData = colorItems[Math.floor(Math.random() * colorItems.length)];
                    attempts++;
                } while (colorData.audioKey === lastBalloonColor && attempts < 10);
                lastBalloonColor = colorData.audioKey;
                return colorData;
            }

            function spawnRandomColor() {
                if (!gameState.gameStarted || currentGameMode !== 'colors') return;
                const colorData = getRandomColorDifferentFromLast();
                const direction = Math.random() > 0.5 ? 'right' : 'left';
                spawnColorBalloon(colorData, direction);
                setTimeout(spawnRandomColor, 3000 + Math.random() * 2000);
            }

            // Start spawning colors
            spawnRandomColor();
            setTimeout(spawnRandomColor, 1500);
        }

        function playAnimalSound(sound) {
            if (!soundEnabled || !audioCtx) return;

            switch(sound) {
                case 'neigh':
                    playTone(400, 0.3, 'sawtooth', 0.3);
                    setTimeout(() => playTone(500, 0.4, 'sawtooth', 0.25), 300);
                    break;
                case 'trumpet':
                    playTone(200, 0.5, 'sawtooth', 0.4);
                    setTimeout(() => playTone(250, 0.3, 'sawtooth', 0.3), 400);
                    break;
                case 'roar':
                    playTone(100, 0.6, 'sawtooth', 0.5);
                    setTimeout(() => playTone(80, 0.4, 'sawtooth', 0.4), 300);
                    break;
                case 'growl':
                    playTone(90, 0.5, 'sawtooth', 0.4);
                    break;
                case 'moo':
                    playTone(150, 0.6, 'sawtooth', 0.3);
                    setTimeout(() => playTone(120, 0.4, 'sawtooth', 0.25), 400);
                    break;
                case 'oink':
                    playTone(300, 0.2, 'square', 0.3);
                    setTimeout(() => playTone(350, 0.15, 'square', 0.25), 150);
                    break;
                case 'baa':
                    playTone(350, 0.3, 'sawtooth', 0.25);
                    setTimeout(() => playTone(300, 0.3, 'sawtooth', 0.2), 250);
                    break;
                case 'bark':
                    playTone(400, 0.15, 'square', 0.4);
                    setTimeout(() => playTone(450, 0.1, 'square', 0.3), 150);
                    break;
                case 'meow':
                    playTone(500, 0.3, 'sine', 0.3);
                    setTimeout(() => playTone(600, 0.2, 'sine', 0.2), 200);
                    break;
            }
        }

        function spawnAnimal(animalData, direction = 'random') {
            const container = document.getElementById('gameContainer');
            const animal = document.createElement('div');
            animal.className = 'walking-animal';

            // Wrap emoji in inner span for click animation
            const innerSpan = document.createElement('span');
            innerSpan.className = 'animal-inner';
            innerSpan.textContent = animalData.emoji;
            animal.appendChild(innerSpan);

            const goRight = direction === 'random' ? Math.random() > 0.5 : direction === 'right';
            animal.classList.add(goRight ? 'walk-right' : 'walk-left');
            animal.classList.add('bounce');

            // Random vertical position
            animal.style.bottom = (5 + Math.random() * 8) + '%';

            animal.addEventListener('click', (e) => {
                initAudio();
                // Play Russian, then Hebrew, then animal sound
                speakBilingual(animalData.audioKey);
                if (animalData.soundFile) {
                    setTimeout(() => playAudio(animalData.soundFile), 2200);
                }
                createSparkles(
                    animal.getBoundingClientRect().left + 30,
                    animal.getBoundingClientRect().top
                );

                // Jump high and get big animation on inner span (doesn't break walking)
                innerSpan.style.transition = 'transform 0.3s ease-out';
                innerSpan.style.transform = 'translateY(-100px) scale(1.8)';
                setTimeout(() => {
                    innerSpan.style.transition = 'transform 0.3s ease-in';
                    innerSpan.style.transform = '';
                }, 300);

                // Show Papa Micha popup when clicking horse
                if (animalData.emoji === 'üê¥') {
                    const rect = animal.getBoundingClientRect();
                    showPapaHorsePopup(rect.left, rect.top);
                }
            });

            container.appendChild(animal);

            // Make animal draggable on touch
            makeAnimalDraggable(animal);

            // Remove after animation
            setTimeout(() => animal.remove(), 26000);
        }

        // Spawn a hatching egg that becomes a chicken
        function spawnHatchingEgg() {
            const container = document.getElementById('gameContainer');
            const egg = document.createElement('div');
            egg.className = 'hatching-egg';
            egg.textContent = 'ü•ö';
            egg.style.left = (20 + Math.random() * 60) + '%';

            let clickCount = 0;

            egg.addEventListener('click', (e) => {
                e.stopPropagation();
                initAudio();
                clickCount++;

                if (clickCount === 1) {
                    // First click - wobble
                    egg.classList.add('wobble');
                    playMagicSound();
                    setTimeout(() => egg.classList.remove('wobble'), 300);
                } else if (clickCount === 2) {
                    // Second click - crack
                    egg.classList.add('cracking');
                    egg.textContent = 'üê£';
                    playMagicSound();
                } else if (clickCount >= 3) {
                    // Third click - hatch!
                    egg.classList.remove('cracking');
                    egg.classList.add('hatched');

                    // Create baby chicken
                    const chicken = document.createElement('div');
                    chicken.className = 'baby-chicken';
                    chicken.textContent = 'üê•';
                    chicken.style.left = egg.style.left;
                    chicken.style.bottom = '12%';

                    chicken.addEventListener('click', (ce) => {
                        ce.stopPropagation();
                        initAudio();
                        speakBilingual('chicken');
                        setTimeout(() => playAudio('chicken_sound.mp3'), 2200);
                        createSparkles(ce.clientX, ce.clientY);
                    });

                    container.appendChild(chicken);

                    // Say chicken in Russian/Hebrew
                    speakBilingual('chicken');
                    setTimeout(() => playAudio('chicken_sound.mp3'), 2200);
                    createSparkles(e.clientX, e.clientY);

                    // Remove egg after hatch animation
                    setTimeout(() => egg.remove(), 800);

                    // Chicken starts walking after born animation
                    setTimeout(() => {
                        chicken.classList.add('walking');
                        // Remove chicken after it walks away
                        setTimeout(() => chicken.remove(), 8000);
                    }, 500);
                }
            });

            container.appendChild(egg);
        }

        // Touch and mouse drag for walking animals
        function makeAnimalDraggable(element) {
            let isDragging = false;
            let startX, startY, startLeft, startBottom;
            let wasWalkingRight = false;

            function startDrag(clientX, clientY) {
                isDragging = true;
                startX = clientX;
                startY = clientY;
                const rect = element.getBoundingClientRect();
                const container = document.getElementById('gameContainer').getBoundingClientRect();
                startLeft = rect.left - container.left;
                startBottom = container.bottom - rect.bottom;
                wasWalkingRight = element.classList.contains('walk-right');
                element.style.animation = 'none';
                element.style.transition = 'none';
                element.style.left = startLeft + 'px';
            }

            function moveDrag(clientX, clientY, e) {
                if (!isDragging) return;
                const deltaX = clientX - startX;
                const deltaY = clientY - startY;

                if (Math.abs(deltaX) > 5 || Math.abs(deltaY) > 5) {
                    if (e) e.preventDefault();
                    const container = document.getElementById('gameContainer').getBoundingClientRect();
                    const newLeft = Math.max(0, Math.min(container.width - 60, startLeft + deltaX));
                    const newBottom = Math.max(0, Math.min(container.height - 80, startBottom - deltaY));
                    element.style.left = newLeft + 'px';
                    element.style.right = 'auto';
                    element.style.bottom = newBottom + 'px';
                }
            }

            function endDrag() {
                if (!isDragging) return;
                isDragging = false;

                const container = document.getElementById('gameContainer').getBoundingClientRect();
                const rect = element.getBoundingClientRect();
                const currentLeft = rect.left - container.left;
                const currentLeftPercent = (currentLeft / container.width) * 100;

                let targetLeft, remainingDistance;
                if (wasWalkingRight) {
                    targetLeft = '110%';
                    remainingDistance = (110 - currentLeftPercent) / 125;
                } else {
                    targetLeft = '-15%';
                    remainingDistance = (currentLeftPercent + 15) / 125;
                }

                const remainingTime = Math.max(2, remainingDistance * 25);
                element.style.transition = `left ${remainingTime}s linear`;
                const bounceAnim = wasWalkingRight ? 'simpleBounceFlipped' : 'simpleBounce';
                element.style.animation = `${bounceAnim} 0.5s ease-in-out infinite`;

                requestAnimationFrame(() => {
                    element.style.left = targetLeft;
                });
            }

            // Touch events
            element.addEventListener('touchstart', (e) => {
                startDrag(e.touches[0].clientX, e.touches[0].clientY);
            }, { passive: true });
            element.addEventListener('touchmove', (e) => {
                moveDrag(e.touches[0].clientX, e.touches[0].clientY, e);
            }, { passive: false });
            element.addEventListener('touchend', endDrag);

            // Mouse events
            element.addEventListener('mousedown', (e) => {
                e.preventDefault();
                startDrag(e.clientX, e.clientY);
            });
            document.addEventListener('mousemove', (e) => {
                moveDrag(e.clientX, e.clientY, e);
            });
            document.addEventListener('mouseup', endDrag);
        }

        function scheduleAnimals() {
            // Always keep a horse on screen
            function spawnHorse() {
                if (!gameState.gameStarted) return;
                const direction = Math.random() > 0.5 ? 'right' : 'left';
                spawnAnimal(animals[0], direction);
                // Spawn another horse after the current one finishes (25s animation + small gap)
                setTimeout(spawnHorse, 27000);
            }

            // Start first horse immediately
            spawnHorse();

            // Elephant at 10 seconds
            setTimeout(() => spawnAnimal(animals[1], 'left'), 10000);

            // Lion at 25 seconds
            setTimeout(() => spawnAnimal(animals[2], 'right'), 25000);

            // Bear at 40 seconds
            setTimeout(() => spawnAnimal(animals[3], 'left'), 40000);

            // Then random animals every 12-20 seconds
            let animalIndex = 4;
            function spawnNextAnimal() {
                if (!gameState.gameStarted) return;

                const randomAnimal = animals[animalIndex % animals.length];
                spawnAnimal(randomAnimal);
                animalIndex++;

                setTimeout(spawnNextAnimal, 12000 + Math.random() * 8000);
            }

            setTimeout(spawnNextAnimal, 55000);

            // Spawn hatching eggs periodically
            function spawnEggPeriodically() {
                if (!gameState.gameStarted) return;
                // Only spawn if no egg currently exists
                if (!document.querySelector('.hatching-egg')) {
                    spawnHatchingEgg();
                }
                // Spawn new egg every 30-45 seconds
                setTimeout(spawnEggPeriodically, 30000 + Math.random() * 15000);
            }
            // First egg after 15 seconds
            setTimeout(spawnEggPeriodically, 15000);

            // Spawn duck that flies in and swims
            function spawnSwimmingDuck() {
                if (!gameState.gameStarted) return;
                // Only spawn if no duck currently exists
                if (document.querySelector('.swimming-duck') || document.querySelector('.flying-duck')) {
                    setTimeout(spawnSwimmingDuck, 20000);
                    return;
                }

                const pond = document.getElementById('pond');
                const pondRect = pond.getBoundingClientRect();

                // Create flying duck
                const flyingDuck = document.createElement('div');
                flyingDuck.className = 'flying-duck';
                flyingDuck.textContent = 'ü¶Ü';
                flyingDuck.style.setProperty('--target-top', (pondRect.top + 40) + 'px');
                flyingDuck.style.setProperty('--target-left', (pondRect.left + 60) + 'px');
                document.body.appendChild(flyingDuck);

                // After flying in, convert to swimming duck
                setTimeout(() => {
                    flyingDuck.remove();

                    const swimmingDuck = document.createElement('div');
                    swimmingDuck.className = 'swimming-duck';
                    swimmingDuck.textContent = 'ü¶Ü';
                    swimmingDuck.style.top = '40%';
                    swimmingDuck.style.left = '20%';

                    swimmingDuck.addEventListener('click', (e) => {
                        e.stopPropagation();
                        initAudio();
                        speakBilingual('duck');
                        setTimeout(() => playAudio('duck_sound.mp3'), 2200);
                        createSparkles(e.clientX, e.clientY);
                    });

                    pond.appendChild(swimmingDuck);

                    // Duck swims for 25 seconds then flies away
                    setTimeout(() => {
                        swimmingDuck.style.transition = 'opacity 1s';
                        swimmingDuck.style.opacity = '0';
                        setTimeout(() => swimmingDuck.remove(), 1000);
                    }, 25000);
                }, 3000);

                // Spawn next duck after 40-60 seconds
                setTimeout(spawnSwimmingDuck, 40000 + Math.random() * 20000);
            }
            // First duck after 20 seconds
            setTimeout(spawnSwimmingDuck, 20000);
        }

        // ============ GAME LOGIC ============
        function updateUI() {
            document.getElementById('levelDisplay').textContent = `Level ${gameState.level}`;
            document.getElementById('scoreDisplay').textContent = `üíé ${gameState.score}`;
            document.getElementById('butterflyCounter').textContent = `ü¶ã ${gameState.butterfliesCaught} / ${gameState.butterfliesNeeded}`;
            document.getElementById('starCounter').textContent = `‚≠ê ${gameState.starsCaught} / ${gameState.starsNeeded}`;
        }

        function checkWinCondition() {
            if (gameState.butterfliesCaught >= gameState.butterfliesNeeded &&
                gameState.starsCaught >= gameState.starsNeeded) {
                winLevel();
            }
        }

        function catchButterfly() {
            gameState.butterfliesCaught++;
            gameState.score += 5;
            updateUI();

            const dog = document.getElementById('dog');
            dog.classList.remove('excited');
            void dog.offsetWidth;
            dog.classList.add('excited');

            playBarkSound();

            if (gameState.butterfliesCaught >= gameState.butterfliesNeeded) {
                winLevel();
            } else {
                movePinkyRandomly();
            }
        }

        function sendButterflyToPinky(x, y) {
            const dog = document.getElementById('dog');
            const rect = dog.getBoundingClientRect();
            const targetX = rect.left + rect.width / 2;
            const targetY = rect.top + rect.height / 2;

            const count = window.multiflyCount > 0 ? 3 : 1;
            if (window.multiflyCount > 0) window.multiflyCount--;

            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    createButterfly(
                        x + (Math.random() - 0.5) * 30,
                        y + (Math.random() - 0.5) * 30,
                        targetX,
                        targetY,
                        // Only catch butterfly if game is active
                        (gameState.gameStarted && !gameState.gamePaused) ? catchButterfly : null
                    );
                }, i * 200);
            }

            createSparkles(x, y);
            playMagicSound();
        }

        function winLevel() {
            gameState.gamePaused = true;

            playWinSound();

            // Calculate stars based on performance
            const stars = Math.min(3, Math.floor(gameState.score / 50) + 1);
            const starsContainer = document.getElementById('winStars');
            starsContainer.innerHTML = '';
            for (let i = 0; i < 3; i++) {
                const star = document.createElement('span');
                star.textContent = i < stars ? '‚≠ê' : '‚òÜ';
                star.style.opacity = i < stars ? '1' : '0.3';
                starsContainer.appendChild(star);
            }

            document.getElementById('winMessage').textContent =
                gameState.level >= 5 ? 'You completed all levels!' : 'You caught Ms. Pinky!';

            document.getElementById('winScreen').classList.add('visible');

            // Celebration sparkles
            for (let i = 0; i < 40; i++) {
                setTimeout(() => {
                    createSparkle(
                        Math.random() * window.innerWidth,
                        Math.random() * window.innerHeight
                    );
                }, i * 80);
            }

            speak('Yay! You did it!', 'en-US', 1, 1.4);
        }

        function nextLevel() {
            gameState.level = Math.min(gameState.level + 1, 5);
            const config = levelConfig[gameState.level];
            gameState.butterfliesNeeded = config.butterflies;
            gameState.pinkySpeed = config.pinkySpeed;
            gameState.butterfliesCaught = 0;
            gameState.starsCaught = 0;
            gameState.gamePaused = false;

            document.getElementById('winScreen').classList.remove('visible');

            updateUI();
            spawnGems();
            spawnPowerups();

            // Reset Pinky position (centered)
            const dog = document.getElementById('dog');
            dog.style.left = '50%';
            dog.style.transform = 'translateX(-50%)';
            dog.style.bottom = '15%';

            playLevelUpSound();
        }

        function restartGame() {
            gameState.level = 1;
            gameState.score = 0;
            gameState.butterfliesCaught = 0;
            gameState.butterfliesNeeded = 5;
            gameState.starsCaught = 0;
            gameState.starsNeeded = 5;
            gameState.pinkySpeed = 1.5;
            gameState.gamePaused = false;

            document.getElementById('winScreen').classList.remove('visible');

            updateUI();
            spawnGems();
            spawnPowerups();

            const dog = document.getElementById('dog');
            dog.style.left = '50%';
            dog.style.transform = 'translateX(-50%)';
            dog.style.bottom = '15%';
        }

        // ============ STORY SEQUENCE ============
        const storySequence = [
            { text: "Once upon a time, in a magical garden...", images: [], audioFile: "story_intro.mp3" },
            { text: "–ñ–∏–ª–∞ –ø—Ä–∏–Ω—Ü–µ—Å—Å–∞ –≠–ª–ª–∏...", images: ["images/Ellie.jpeg"], audio: "princess_ellie", keepPrevious: false },
            { text: "...–∏ –ø—Ä–∏–Ω—Ü–µ—Å—Å–∞ –ú–∞—è!", images: ["images/Maya.jpeg"], audio: "princess_maya", keepPrevious: true },
            { text: "–ò –∏—Ö –ª—é–±–∏–º–∞—è —Å–æ–±–∞—á–∫–∞ –ü–∏–Ω–∫–∏!", images: ["images/Pinky.jpeg"], audio: "pinky", keepPrevious: false },
            { text: "Click the butterflies and stars!", images: [], audioFiles: ["story_instructions_en.mp3", "story_instructions.mp3"], keepPrevious: false }
        ];

        let storyIndex = 0;
        let storyTimer = null;

        function showStory() {
            const screen = document.getElementById('storyScreen');
            const textEl = document.getElementById('storyText');
            const image1El = document.getElementById('storyImage1');
            const image2El = document.getElementById('storyImage2');

            screen.classList.add('visible');

            function showNext() {
                if (storyIndex >= storySequence.length) {
                    screen.classList.remove('visible');
                    setTimeout(showInstructions, 500);
                    return;
                }

                const story = storySequence[storyIndex];

                textEl.classList.remove('visible');

                // Only hide images if not keeping previous
                if (!story.keepPrevious) {
                    image1El.classList.remove('visible');
                    image2El.classList.remove('visible');
                    image1El.innerHTML = '';
                    image2El.innerHTML = '';
                }

                setTimeout(() => {
                    textEl.textContent = story.text;
                    textEl.classList.add('visible');

                    // Handle images
                    if (story.images && story.images.length > 0) {
                        if (story.keepPrevious) {
                            // Add to second slot, keep first
                            image2El.innerHTML = `<img src="${story.images[0]}" alt="">`;
                            setTimeout(() => image2El.classList.add('visible'), 300);
                        } else {
                            // Show in first slot
                            image1El.innerHTML = `<img src="${story.images[0]}" alt="">`;
                            setTimeout(() => image1El.classList.add('visible'), 300);
                        }
                    }

                    // Play audio
                    if (story.audioFiles) {
                        // Multiple audio files (English then Russian)
                        playAudio(story.audioFiles[0]);
                        setTimeout(() => playAudio(story.audioFiles[1]), 1800);
                    } else if (story.audioFile) {
                        // Single audio file (intro)
                        playAudio(story.audioFile);
                    } else if (story.audio) {
                        // Russian then Hebrew for character names
                        playAudio(story.audio + '_ru.mp3');
                        setTimeout(() => playAudio(story.audio + '_he.mp3'), 1200);
                    }
                }, 300);

                storyIndex++;
                storyTimer = setTimeout(showNext, story.audioFiles ? 4500 : (story.audio || story.audioFile) ? 3000 : 3500);
            }

            showNext();
        }

        function skipStory() {
            if (storyTimer) {
                clearTimeout(storyTimer);
                storyTimer = null;
            }
            storyIndex = storySequence.length;
            document.getElementById('storyScreen').classList.remove('visible');
            showInstructions();
        }

        function showInstructions() {
            document.getElementById('instructionsPopup').classList.add('visible');
        }

        function startGame() {
            document.getElementById('instructionsPopup').classList.remove('visible');
            gameState.gameStarted = true;
            updateUI();
            spawnGems();
            spawnPowerups();
            startPinkyMovement();
            animatePrincesses();

            // Start animals or colors based on game mode
            if (currentGameMode === 'colors') {
                scheduleColors();
            } else {
                scheduleAnimals();
            }

            // Add clickable stars, butterflies, and birds
            createClickableStars();
            scheduleButterflies();
            scheduleFlyingBirds();

            if (musicEnabled) {
                playBackgroundMusic();
            }
        }

        // ============ EVENT LISTENERS ============
        function setupEventListeners() {
            // Start button
            document.getElementById('startButton').addEventListener('click', () => {
                initAudio();
                document.getElementById('titleScreen').classList.add('hidden');
                setTimeout(() => showStory(), 500);
            });

            // Skip story
            document.getElementById('skipStory').addEventListener('click', skipStory);

            // Start game
            document.getElementById('startGameBtn').addEventListener('click', startGame);

            // Sound toggle
            document.getElementById('soundToggle').addEventListener('click', () => {
                soundEnabled = !soundEnabled;
                document.getElementById('soundToggle').textContent = soundEnabled ? 'üîä' : 'üîá';
            });

            // Music toggle
            document.getElementById('musicToggle').addEventListener('click', () => {
                initAudio();
                musicEnabled = !musicEnabled;
                document.getElementById('musicToggle').textContent = musicEnabled ? 'üéµ' : 'üéµ';
                document.getElementById('musicToggle').style.opacity = musicEnabled ? '1' : '0.5';

                if (musicEnabled && gameState.gameStarted) {
                    playBackgroundMusic();
                } else {
                    stopBackgroundMusic();
                }
            });

            // Win screen buttons
            document.getElementById('nextLevelBtn').addEventListener('click', nextLevel);
            document.getElementById('playAgainBtn').addEventListener('click', restartGame);

            // Flowers - disappear and regrow (no butterflies)
            document.querySelectorAll('.flower').forEach(flower => {
                const handler = (e) => {
                    e.preventDefault();
                    if (flower.classList.contains('growing')) return;

                    initAudio();
                    playMagicSound();
                    speakBilingual('flower'); // —Ü–≤–µ—Ç–æ–∫ / ◊§◊®◊ó
                    createSparkles(e.clientX || e.touches[0].clientX, e.clientY || e.touches[0].clientY);

                    // Flower disappears
                    flower.style.transition = 'transform 0.3s, opacity 0.3s';
                    flower.style.transform = 'scale(0)';
                    flower.style.opacity = '0';

                    // Flower regrows after delay
                    setTimeout(() => {
                        flower.classList.add('growing');
                        flower.style.transition = 'transform 0.5s ease-out, opacity 0.5s';
                        flower.style.transform = 'scale(1.2)';
                        flower.style.opacity = '1';
                        setTimeout(() => {
                            flower.style.transform = 'scale(1)';
                            flower.classList.remove('growing');
                        }, 500);
                    }, 2000 + Math.random() * 1000);
                };
                flower.addEventListener('click', handler);
                flower.addEventListener('touchstart', handler, { passive: false });
            });

            // Characters - Russian then Hebrew
            document.getElementById('princess1').addEventListener('click', (e) => {
                initAudio();
                createHeart(e.clientX, e.clientY);
                createSparkles(e.clientX, e.clientY);
                createFloatingHearts();
                playHeartSound();
                // Russian "–ü—Ä–∏–Ω—Ü–µ—Å—Å–∞ –≠–ª–ª–∏" then Hebrew "◊†◊°◊ô◊õ◊î ◊ê◊ú◊ô"
                playAudio('princess_ellie_ru.mp3');
                setTimeout(() => playAudio('princess_ellie_he.mp3'), 1200);
            });

            document.getElementById('princess2').addEventListener('click', (e) => {
                initAudio();
                createHeart(e.clientX, e.clientY);
                createSparkles(e.clientX, e.clientY);
                createFloatingHearts();
                playHeartSound();
                // Russian "Princess Maya" then Hebrew "Princess Maya"
                playAudio('princess_maya_ru.mp3');
                setTimeout(() => playAudio('princess_maya_he.mp3'), 1200);
                // Toddler voice: "–ì–¥–µ –º–æ—è –°–∞–Ω–∞?" (once)
                setTimeout(() => playAudio('maya_sana_ru.mp3'), 2400);
                // Old woman voice: "–ú–∞—è –±—É—Å—è" (once)
                setTimeout(() => playAudio('maya_boosa.mp3'), 4500);
            });

            document.getElementById('dog').addEventListener('click', (e) => {
                initAudio();
                createHeart(e.clientX, e.clientY);
                createSparkles(e.clientX, e.clientY);
                // Russian "–°–æ–±–∞—á–∫–∞ –ü–∏–Ω–∫–∏" then Hebrew "◊õ◊ú◊ë◊ú◊ë ◊§◊ô◊†◊ß◊ô" then bark
                playAudio('pinky_ru.mp3');
                setTimeout(() => playAudio('pinky_he.mp3'), 1200);
                setTimeout(() => playBarkSound(), 2400);
            });

            // Environment - Rainbow interaction
            let sunIsDancing = false;

            function makeSunDance() {
                const sun = document.getElementById('sun');
                sun.classList.add('dancing');
                sun.classList.add('centered'); // Move sun to center
                sunIsDancing = true;
                // Stop dancing after 5 seconds if sun not pressed
                setTimeout(() => {
                    if (sunIsDancing) {
                        sun.classList.remove('dancing');
                        sun.classList.remove('centered');
                        sunIsDancing = false;
                    }
                }, 5000);
            }

            function showRainbowWithFade() {
                const rainbow = document.getElementById('rainbow');
                // Reset animation by removing and re-adding class
                rainbow.classList.remove('visible');
                void rainbow.offsetWidth; // Force reflow
                rainbow.classList.add('visible');
                // Remove class after animation completes (10 seconds)
                setTimeout(() => {
                    rainbow.classList.remove('visible');
                }, 10000);
            }

            document.getElementById('sun').addEventListener('click', () => {
                initAudio();
                speakBilingual('sun'); // —Å–æ–ª–Ω—Ü–µ / ◊©◊û◊©
                playMagicSound();

                if (sunIsDancing) {
                    // Cloud was pressed, sun is dancing - show rainbow
                    const sun = document.getElementById('sun');
                    sun.classList.remove('dancing');
                    sunIsDancing = false;
                    showRainbowWithFade();
                }
            });

            document.getElementById('moon').addEventListener('click', () => {
                initAudio();
                speakBilingual('moon'); // –ª—É–Ω–∞ / ◊ô◊®◊ó
                playMagicSound();
                // Create stars around moon
                const moon = document.getElementById('moon');
                const rect = moon.getBoundingClientRect();
                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        const star = document.createElement('div');
                        star.textContent = '‚≠ê';
                        star.style.cssText = `
                            position: fixed;
                            left: ${rect.left + Math.random() * 100 - 20}px;
                            top: ${rect.top + Math.random() * 100 - 20}px;
                            font-size: 20px;
                            pointer-events: none;
                            animation: starTwinkle 1s ease-out forwards;
                            z-index: 1000;
                        `;
                        document.body.appendChild(star);
                        setTimeout(() => star.remove(), 1000);
                    }, i * 100);
                }
            });

            document.querySelectorAll('.cloud').forEach(cloud => {
                cloud.addEventListener('click', () => {
                    initAudio();
                    playMagicSound();
                    speakBilingual('cloud'); // –æ–±–ª–∞–∫–æ / ◊¢◊†◊ü
                    makeSunDance();
                    // Rain and lightning
                    makeItRain();
                    setTimeout(() => makeLightning(), 300);
                });
            });

            document.getElementById('rainbow').addEventListener('click', (e) => {
                initAudio();
                speakBilingual('rainbow'); // —Ä–∞–¥—É–≥–∞ / ◊ß◊©◊™
                createSparkles(e.clientX, e.clientY);
                playMagicSound();
            });

            document.getElementById('tree').addEventListener('click', (e) => {
                initAudio();
                playMagicSound();
                speakBilingual('tree'); // –¥–µ—Ä–µ–≤–æ / ◊¢◊•
                createBird(e.clientX, e.clientY - 50);
                setTimeout(() => createBird(e.clientX + 30, e.clientY - 30), 300);
                createSparkles(e.clientX, e.clientY);
            });

            document.getElementById('pond').addEventListener('click', (e) => {
                initAudio();
                speakBilingual('pond'); // –ø—Ä—É–¥ / ◊ë◊®◊ô◊õ◊î
                const pond = document.getElementById('pond');
                const fish = document.getElementById('fish');

                // Create splash effect
                const rect = pond.getBoundingClientRect();
                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        const splash = document.createElement('div');
                        splash.className = 'splash';
                        splash.textContent = 'üíß';
                        splash.style.position = 'fixed';
                        splash.style.left = (rect.left + rect.width/2 + (Math.random()-0.5)*60) + 'px';
                        splash.style.top = (rect.top + 20) + 'px';
                        document.body.appendChild(splash);
                        setTimeout(() => splash.remove(), 600);
                    }, i * 50);
                }

                fish.classList.remove('jump');
                fish.style.animation = 'none';
                void fish.offsetWidth;
                fish.classList.add('jump');
                playSplashSound();
                // Resume swimming after jump
                setTimeout(() => {
                    fish.classList.remove('jump');
                    fish.style.animation = 'fishSwim 6s ease-in-out infinite';
                }, 1800);

                // Pinky goes crazy
                const dog = document.getElementById('dog');
                dog.classList.remove('excited');
                void dog.offsetWidth;
                dog.classList.add('excited');
                playBarkSound();
                setTimeout(() => playBarkSound(), 200);
                setTimeout(() => playBarkSound(), 400);
            });

            // Fish click handler
            document.getElementById('fish').addEventListener('click', (e) => {
                e.stopPropagation();
                initAudio();
                speakBilingual('fish'); // —Ä—ã–±–∞ / ◊ì◊í
                createSparkles(e.clientX, e.clientY);
            });

            // Fish jumps periodically
            function fishJumpPeriodically() {
                const fish = document.getElementById('fish');
                if (fish && gameState.gameStarted) {
                    fish.classList.remove('jump');
                    fish.style.animation = 'none';
                    void fish.offsetWidth;
                    fish.classList.add('jump');
                    playSplashSound();
                    // Resume swimming after jump completes
                    setTimeout(() => {
                        fish.classList.remove('jump');
                        fish.style.animation = 'fishSwim 6s ease-in-out infinite';
                    }, 1800);
                }
                setTimeout(fishJumpPeriodically, 12000 + Math.random() * 8000);
            }
            setTimeout(fishJumpPeriodically, 10000);

            let castleClickCount = 0;
            document.getElementById('castle').addEventListener('click', () => {
                initAudio();
                const interaction = castleClickCount % 4;

                if (interaction === 0) {
                    // Papa: Ice cream
                    playAudio('papa_icecream_ru.mp3');
                    setTimeout(() => playAudio('icecream_he.mp3'), 2500);
                    showKingPopup('–ì–¥–µ –º–æ–∏ –¥–µ–≤–æ—á–∫–∏? –í—Ä–µ–º—è –¥–ª—è ◊í◊ú◊ô◊ì◊î!');
                } else if (interaction === 1) {
                    // Oksana: Where is my boosa (Russian only)
                    playAudio('sana_boosa_ru.mp3');
                    showSanaPopup();
                } else if (interaction === 2) {
                    // Veronika: Pinky come home (Russian only)
                    playAudio('veronika_pinky_ru.mp3');
                    showVeronikaPopup();
                } else {
                    // Papa: Restaurant
                    playAudio('papa_restaurant_ru.mp3');
                    setTimeout(() => playAudio('restaurant_he.mp3'), 2000);
                    showKingPopup('–ü–æ–π–¥—ë–º –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω!');
                }

                castleClickCount++;
            });

            document.getElementById('gameTitle').addEventListener('click', (e) => {
                initAudio();
                for (let i = 0; i < 20; i++) {
                    setTimeout(() => createSparkle(e.clientX + (Math.random()-0.5)*100, e.clientY + (Math.random()-0.5)*50), i * 30);
                }
                playMagicSound();
            });

            // Sky click
            document.getElementById('sky').addEventListener('click', (e) => {
                initAudio();
                playMagicSound();
                speakBilingual('sky'); // –Ω–µ–±–æ / ◊©◊û◊ô◊ô◊ù
                // Create a star
                const star = document.createElement('div');
                star.textContent = '‚≠ê';
                star.style.cssText = `
                    position: fixed;
                    left: ${e.clientX}px;
                    top: ${e.clientY}px;
                    font-size: 30px;
                    pointer-events: none;
                    animation: floatUp 2s ease-out forwards;
                    z-index: 1000;
                `;
                document.body.appendChild(star);
                setTimeout(() => star.remove(), 2000);
            });

            // Grass click
            document.getElementById('grassContainer').addEventListener('click', (e) => {
                initAudio();
                playMagicSound();
                speakBilingual('grass'); // —Ç—Ä–∞–≤–∞ / ◊ì◊©◊ê
                createSparkles(e.clientX, e.clientY);
            });

            // Ground click (darker green area below)
            document.getElementById('ground').addEventListener('click', (e) => {
                initAudio();
                playMagicSound();
                speakBilingual('grass'); // —Ç—Ä–∞–≤–∞ / ◊ì◊©◊ê
                createSparkles(e.clientX, e.clientY);
            });
        }

        // ============ PASSWORD PROTECTION ============
        function checkPassword() {
            const input = document.getElementById('passwordInput');
            const error = document.getElementById('passwordError');
            const password = input.value.toLowerCase().trim();

            if (password === 'pinky') {
                document.getElementById('passwordScreen').classList.add('hidden');
                document.getElementById('gameModeMenu').classList.add('visible');
                localStorage.setItem('princessGameAuth', 'true');
            } else {
                error.classList.add('visible');
                input.value = '';
                setTimeout(() => error.classList.remove('visible'), 2000);
            }
        }

        function selectGameMode(mode) {
            currentGameMode = mode;
            document.getElementById('gameModeMenu').classList.remove('visible');

            // If game is already started, restart the appropriate spawning
            if (gameState.gameStarted) {
                if (mode === 'colors') {
                    scheduleColors();
                } else {
                    scheduleAnimals();
                }
            }
        }

        function showGameModeMenu() {
            // Remove all balloons and animals when switching modes
            document.querySelectorAll('.walking-balloon').forEach(b => b.remove());
            document.querySelectorAll('.walking-animal').forEach(a => a.remove());
            // Reset last color tracking
            lastBalloonColor = null;
            // Show the menu
            document.getElementById('gameModeMenu').classList.add('visible');
        }

        function setupPasswordScreen() {
            // Check if already authenticated
            if (localStorage.getItem('princessGameAuth') === 'true') {
                document.getElementById('passwordScreen').classList.add('hidden');
                document.getElementById('gameModeMenu').classList.add('visible');
            } else {
                // Auto-focus password input
                document.getElementById('passwordInput').focus();

                document.getElementById('passwordButton').addEventListener('click', checkPassword);
                document.getElementById('passwordInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') checkPassword();
                });
            }

            // Game mode buttons
            document.getElementById('btnAnimals').addEventListener('click', () => {
                selectGameMode('animals');
            });
            document.getElementById('btnColors').addEventListener('click', () => {
                selectGameMode('colors');
            });

            // Menu button to go back to game selection
            document.getElementById('menuButton').addEventListener('click', () => {
                showGameModeMenu();
            });
        }

        // ============ TOUCH AND MOUSE DRAG FOR CHARACTERS ============
        function makeDraggable(element) {
            let isDragging = false;
            let startX, startY, startLeft, startBottom;
            let hasMoved = false;

            function startDrag(clientX, clientY) {
                isDragging = true;
                hasMoved = false;
                startX = clientX;
                startY = clientY;
                const rect = element.getBoundingClientRect();
                const container = document.getElementById('gameContainer').getBoundingClientRect();
                startLeft = rect.left - container.left;
                startBottom = container.bottom - rect.bottom;
                element.style.transition = 'none';
            }

            function moveDrag(clientX, clientY, e) {
                if (!isDragging) return;
                const deltaX = clientX - startX;
                const deltaY = clientY - startY;

                if (Math.abs(deltaX) > 10 || Math.abs(deltaY) > 10) {
                    hasMoved = true;
                    if (e) e.preventDefault();
                    const container = document.getElementById('gameContainer').getBoundingClientRect();
                    const newLeft = Math.max(0, Math.min(container.width - 100, startLeft + deltaX));
                    const newBottom = Math.max(0, Math.min(container.height - 150, startBottom - deltaY));
                    element.style.left = (newLeft / container.width * 100) + '%';
                    element.style.bottom = (newBottom / container.height * 100) + '%';
                }
            }

            function endDrag() {
                isDragging = false;
                element.style.transition = '';

                // Check if both princesses are at the castle
                checkPrincessesAtCastle();
            }

            // Touch events
            element.addEventListener('touchstart', (e) => {
                startDrag(e.touches[0].clientX, e.touches[0].clientY);
            }, { passive: true });
            element.addEventListener('touchmove', (e) => {
                moveDrag(e.touches[0].clientX, e.touches[0].clientY, e);
            }, { passive: false });
            element.addEventListener('touchend', endDrag);

            // Mouse events
            element.addEventListener('mousedown', (e) => {
                e.preventDefault();
                startDrag(e.clientX, e.clientY);
            });
            document.addEventListener('mousemove', (e) => {
                moveDrag(e.clientX, e.clientY, e);
            });
            document.addEventListener('mouseup', endDrag);

            // Return whether it was a drag or a tap
            element.wasDragged = () => hasMoved;
        }

        let princessesAtCastleAnnounced = false;

        function checkPrincessesAtCastle() {
            const castle = document.getElementById('castle');
            const princess1 = document.getElementById('princess1');
            const princess2 = document.getElementById('princess2');

            if (!castle || !princess1 || !princess2) return;

            const castleRect = castle.getBoundingClientRect();
            const p1Rect = princess1.getBoundingClientRect();
            const p2Rect = princess2.getBoundingClientRect();

            // Check if princess center is within castle bounds (with some margin)
            const margin = 50;
            const p1AtCastle = p1Rect.left < castleRect.right + margin &&
                              p1Rect.right > castleRect.left - margin &&
                              p1Rect.bottom > castleRect.top - margin &&
                              p1Rect.top < castleRect.bottom + margin;

            const p2AtCastle = p2Rect.left < castleRect.right + margin &&
                              p2Rect.right > castleRect.left - margin &&
                              p2Rect.bottom > castleRect.top - margin &&
                              p2Rect.top < castleRect.bottom + margin;

            if (p1AtCastle && p2AtCastle && !princessesAtCastleAnnounced) {
                princessesAtCastleAnnounced = true;

                // Stop all music and sounds
                if (bgMusic) {
                    bgMusic.pause();
                }

                // Make castle celebrate (huge and dancing)
                castle.classList.add('celebrating');

                // Create lots of sparkles
                for (let i = 0; i < 30; i++) {
                    setTimeout(() => {
                        createSparkles(
                            castleRect.left + Math.random() * castleRect.width,
                            castleRect.top + Math.random() * castleRect.height
                        );
                    }, i * 100);
                }

                // Play home in Russian then Hebrew (only these sounds)
                initAudio();
                playAudio('home_ru.mp3');
                setTimeout(() => playAudio('home_he.mp3'), 1500);

                // After celebration, return to normal
                setTimeout(() => {
                    castle.classList.remove('celebrating');

                    // Resume music if it was enabled
                    if (musicEnabled && bgMusic) {
                        bgMusic.play();
                    }

                    // Reset so it can trigger again
                    setTimeout(() => {
                        princessesAtCastleAnnounced = false;
                    }, 3000);
                }, 5000);
            }
        }

        function setupDraggableCharacters() {
            makeDraggable(document.getElementById('princess1'));
            makeDraggable(document.getElementById('princess2'));
            makeDraggable(document.getElementById('dog'));
        }

        // ============ INITIALIZATION ============
        function init() {
            setupPasswordScreen();
            generateGrass();
            createTitleSparkles();
            setupEventListeners();
            setupDraggableCharacters();

            // Preload ElevenLabs audio files
            preloadAllAudio();

            console.log('üè∞ Princess Garden Adventure loaded! ü¶ã');
        }

        // Start when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }

        // Regenerate grass on resize
        window.addEventListener('resize', generateGrass);
    </script>
</body>
</html>
